<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.33">

  <meta name="author" content="Prof.&nbsp;Mikael Mortensen, University of Oslo">
  <title>MATMEK-4270 presentations – Solving PDEs with the FEM</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-308b9879f03a02505d6580673c2f6257.css">
  <link rel="stylesheet" href="styles.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Solving PDEs with the FEM</h1>
  <p class="subtitle">MATMEK-4270</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Prof.&nbsp;Mikael Mortensen, University of Oslo 
</div>
</div>
</div>

</section>
<section id="solving-pdes-with-the-finite-element-method" class="slide level2 smaller">
<h2>Solving PDEs with the finite element method</h2>
<p>The procedure for solving differential equations with the finite element method is much the same as for global basis functions. However</p>
<ul>
<li>Basis functions <span class="math inline">\(\psi_j(x)\)</span> are local <span class="math display">\[
u_N(x) = \sum_{j=0}^N \hat{u}_j \psi_j(x)
\]</span></li>
</ul>
<ul>
<li class="fragment">We always use reference elements (lines, triangles, tetrahedra)</li>
<li class="fragment">Matrices and vectors are assembled elementwise <span class="math display">\[
a_{ij} = (\psi_j, \psi_i) = \sum_{e=0}^{N_e-1} \int_{\Omega^{(e)}} \psi_j \psi_i d\Omega = \sum_{e=0}^{N_e-1} A_e
\]</span></li>
<li class="fragment">It is very common to use Lagrange polynomials for basis functions</li>
<li class="fragment">PDEs are normally not solved using tensor products in multiple dimensions</li>
</ul>
</section>
<section id="solving-pdes-with-fem" class="slide level2 smaller">
<h2>Solving PDEs with FEM</h2>
<p>The Galerkin method is as always: Find <span class="math inline">\(u_N \in V_N\)</span> such that <span class="math display">\[
(\mathcal{R}_N, v) = 0, \quad \forall \, v \in V_N,
\]</span> where <span class="math inline">\(\mathcal{R}_N = \mathcal{L}(u_N)-f\)</span> is a residual and <span class="math inline">\(\mathcal{L}(u)\)</span> is some mathematical operator.</p>
<ul>
<li>Choose <span class="math inline">\(V_N\)</span> and everything follows.</li>
<li>Insert for <span class="math inline">\(u_N = \sum_{j=0}^N \hat{u}_j \psi_j\)</span> and <span class="math inline">\(v=\psi_i\)</span> to obtain the linear algebra problem.</li>
</ul>
<ul>
<li class="fragment">All the complexity lies in the implementation, using elementwise integration and mapping to a reference domain.</li>
<li class="fragment">It is very common (and some times necessary) to use integration by parts or Green’s first identity in order to manipulate the variational equation and to incorporate <strong>natural</strong> Neumann boundary conditions.</li>
<li class="fragment">Boundary conditions are <strong>not</strong> incorporated into the basis functions.</li>
<li class="fragment">We will only use (local) Lagrange polynomials as basis functions, but there are many other options.</li>
</ul>
</section>
<section id="example---poissons-equation-with-inhomogeneous-dirichlet-boundary-conditions" class="slide level2 smaller">
<h2>Example - Poisson’s equation with inhomogeneous Dirichlet boundary conditions</h2>
<p><span class="math display">\[
u'' = f, \quad x \in (0, L), \, u(0) = a, u(L) = b,
\]</span></p>
<p>First choose <span class="math inline">\(V_N\)</span>. We can here use piecewise linear polynomials or even higher order</p>
<p><span class="math display">\[
V_N = \text{span}\{\psi_j(x)\}_{j=0}^N
\]</span></p>
<p>Remember</p>
<p><span class="math display">\[
\psi_j(x_i) = \delta_{ij}
\]</span></p>
<p>so each basis function is one in exactly one node and zero in all the others. Quadratic:</p>
<div id="709012b9" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="fempdes_files/figure-revealjs/cell-2-output-1.png" width="912" height="195"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="use-integration-by-parts" class="slide level2 smaller">
<h2>Use integration by parts</h2>
<p>The variational Galerkin form is now to find <span class="math inline">\(u_N \in V_N\)</span> such that</p>
<p><span class="math display">\[
(u_N'', v) = (f, v), \quad \forall \, v \in V_N
\]</span></p>
<div class="callout callout-warning callout-style-simple">
<div class="callout-body">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-content">
<p>But piecewise polynomials cannot be differentiated twice!</p>
</div>
</div>
</div>
<div class="fragment">
<p>Solution: integration by parts <span class="math inline">\(\left((u'', v) = -(u', v')+ [u'v]_{x=x_L}^{x=x_R}\right)\)</span></p>
<p><span class="math display">\[
(u_N', v') = -(f, v) + [u_N'v]_{x=0}^{x=L}, \quad \forall \, v \in V_N
\]</span></p>
<p>Inserting for <span class="math inline">\(u_N\)</span> and <span class="math inline">\(v=\psi_i\)</span> we get the linear algebra problem</p>
<p><span class="math display">\[
\sum_{j=0}^N(\psi'_j, \psi'_i) \hat{u}_j = -(f, \psi_i) + u'_N(L)\psi_i(L) - u'_N(0)\psi_i(0)
\]</span></p>
<p>Since <span class="math inline">\(\psi_i(0)=1\)</span> for <span class="math inline">\(i=0\)</span> and <span class="math inline">\(\psi_i(L)=1\)</span> for <span class="math inline">\(i=N\)</span> and zero for all <span class="math inline">\(i=1, 2, \ldots, N-1\)</span> the last two terms are only relevant for <span class="math inline">\(i=0\)</span> and <span class="math inline">\(i=N\)</span>.</p>
</div>
</section>
<section id="dirichlet-boundary-conditions" class="slide level2 smaller">
<h2>Dirichlet boundary conditions</h2>
<p>We have <span class="math inline">\(N+1\)</span> equations for <span class="math inline">\(N+1\)</span> unknowns <span class="math inline">\(\{\hat{u}_i\}_{i=0}^N\)</span> <span class="math display">\[
\sum_{j=0}^N(\psi'_j, \psi'_i) \hat{u}_j = -(f, \psi_i) + u'_N(L)\psi_i(L) - u'_N(0)\psi_i(0)
\]</span></p>
<p>The boundary term <span class="math inline">\(u'_N(L)\psi_i(L) - u'_N(0)\psi_i(0)\)</span> can be used to specify Neumann boundary conditions. For Dirichlet we have</p>
<p><span class="math display">\[
u(0) = u_N(x_0) = \sum_{j=0}^N \hat{u}_j \psi_j(x_0) = \psi_0(x_0) \hat{u}_0 = \hat{u}_0 = a
\]</span></p>
<p>and</p>
<p><span class="math display">\[
u(L) = u_N(x_N) = \sum_{j=0}^N \hat{u}_j \psi_j(x_N) = \psi_N(x_N) \hat{u}_N = \hat{u}_N = b.
\]</span></p>
<p>Hence <span class="math inline">\(\hat{u}_0=a\)</span> and <span class="math inline">\(\hat{u}_N=b\)</span> are determined from bcs, leaving <span class="math inline">\(N-1\)</span> unknowns <span class="math inline">\(\{\hat{u}_i\}_{i=1}^{N-1}\)</span></p>
</section>
<section id="assembly-incorporating-dirichlet" class="slide level2 smaller">
<h2>Assembly incorporating Dirichlet</h2>
<p><span class="math display">\[
\sum_{j=0}^N(\psi'_j, \psi'_i) \hat{u}_j = -(f, \psi_i), \quad i=1, 2, \ldots, N-1
\]</span></p>
<p><span class="math display">\[
\hat{u}_0=a \text{ and } \hat{u}_N=b
\]</span></p>
<p>Matrix form, using <span class="math inline">\(s_{ij} = (\psi'_j, \psi'_i)\)</span> and <span class="math inline">\(f_i = (f, \psi_i)\)</span>:</p>
<p><span class="math display">\[
\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; \cdots &amp; 0 \\
s_{10} &amp; s_{11}&amp; s_{12} &amp; \cdots &amp; s_{1N} \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \cdots \\
s_{N-1, 0} &amp; s_{N-1, 1}&amp; s_{N-1, 2}&amp; \cdots &amp; s_{N-1,N} \\
0 &amp; \cdots &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
\begin{bmatrix}
\hat{u}_0 \\
\hat{u}_1 \\
\vdots \\
\hat{u}_{N-1} \\
\hat{u}_N
\end{bmatrix}
=
\begin{bmatrix}
a \\
-f_1 \\
\vdots \\
-f_{N-1} \\
b
\end{bmatrix}
\]</span></p>
<p>Note the idented first and last row due to bcs. Also, most of the <span class="math inline">\(s_{ij}\)</span> items will be zero since the basis functions are local.</p>
</section>
<section id="finite-element-assembly" class="slide level2 smaller">
<h2>Finite element assembly</h2>
<p><span class="math display">\[
s_{ij} = (\psi'_j, \psi'_i) = \sum_{e=0}^{N_e-1} \int_{\Omega^{(e)}} \psi'_j \psi'_i d\Omega
\]</span></p>
<p>We will use the same notation as in lecture 10 and</p>
<p><span class="math display">\[
s^{(e)}_{ij} = \int_{\Omega^{(e)}} \psi'_j \psi'_i d\Omega
\]</span></p>
<p>is the element stiffness matrix of shape <span class="math inline">\((N+1) \times (N+1)\)</span>. We also use the same mapping from local to global degrees of freedom, and define a dense element matrix as</p>
<p><span class="math display">\[
\tilde{s}^{(e)}_{rs} = s^{(e)}_{q(e,r), q(e, s)}, \, (r, s) \in \mathcal{I}_d^2
\]</span></p>
<p>for finite elements of order <span class="math inline">\(d\)</span> and <span class="math inline">\(\mathcal{I}_d=\{0, 1, \ldots, d\}\)</span>. Remember that <span class="math inline">\(d=1\)</span> for linear elements, and then higher order elements (<span class="math inline">\(d&gt;1\)</span>) simply use more nodes within each element.</p>
</section>
<section id="mapping-to-reference-domain-tildeomega--1-1" class="slide level2 smaller">
<h2>Mapping to reference domain <span class="math inline">\(\tilde{\Omega} = [-1, 1]\)</span></h2>
<p>The finite element stiffness matrix is implemented using a mapping to the reference domain <span class="math inline">\(X\in[-1, 1]\)</span>, and the reference basis functions</p>
<p><span class="math display">\[
\psi_{q(e, r)}(x) = \ell_r(X)
\]</span></p>
<p>where the element is <span class="math inline">\(\Omega^{(e)} = [x_L, x_R]\)</span> and <span class="math inline">\(h(e)=x_R-x_L\)</span>, such that</p>
<p><span class="math display">\[
x = \frac{1}{2}(x_L+x_R) + \frac{h(e)}{2}X \quad \text{and} \quad
\frac{dx}{dX} = \frac{h(e)}{2}
\]</span></p>
<p>Inserting this into the expression for <span class="math inline">\(\tilde{s}_{rs}\)</span>:</p>
<p><span class="math display">\[
\begin{align*}
\tilde{s}^{(e)}_{rs} &amp;= \int_{\Omega^{(e)}} \frac{d \psi_{q(e, s)}(x)}{dx} \frac{d \psi_{q(e, r)}(x)}{dx} dx, \\
&amp;= \int_{-1}^1 \frac{d \ell_s(X)}{dX} \frac{dX}{dx} \frac{d \ell_r(X)}{dX} \frac{dX}{dx} \frac{dx}{dX}dX
\end{align*}
\]</span></p>
</section>
<section id="element-stiffness-matrix" class="slide level2 smaller">
<h2>Element stiffness matrix</h2>
<p>We get</p>
<p><span class="math display">\[
\tilde{s}^{(e)}_{rs} = \int_{-1}^1 \frac{d \ell_s(X)}{dX} \frac{d \ell_r(X)}{dX} \frac{2}{h(e)} dX
\]</span></p>
<p>which is also</p>
<p><span class="math display">\[
\tilde{s}^{(e)}_{rs} = \frac{2}{h(e)} \int_{-1}^1 \ell'_s(X) \ell'_r(X) dX
\]</span></p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Note that the integral is independent of the actual element. All information about element <span class="math inline">\(e\)</span> is in the size <span class="math inline">\(h(e)\)</span>.</p>
</div>
</div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>For piecewise linear elements the integrand is constant! For higher order elements the integral requires some actual work!</p>
</div>
</div>
</div>
</section>
<section id="implementation" class="slide level2 smaller">
<h2>Implementation</h2>
<div id="a0adaea4" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a><span class="im">from</span> lagrange <span class="im">import</span> Lagrangebasis, Lagrangefunction</span>
<span id="cb1-2"><a></a>x, h <span class="op">=</span> sp.symbols(<span class="st">'x,h'</span>)</span>
<span id="cb1-3"><a></a>l <span class="op">=</span> Lagrangebasis([<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb1-4"><a></a>se <span class="op">=</span> <span class="kw">lambda</span> r, s: sp.integrate(l[r].diff(x, <span class="dv">1</span>)<span class="op">*</span>l[s].diff(x, <span class="dv">1</span>), (x, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb1-5"><a></a>S1e <span class="op">=</span> <span class="dv">2</span><span class="op">/</span>h<span class="op">*</span>sp.Matrix([[se(<span class="dv">0</span>, <span class="dv">0</span>), se(<span class="dv">0</span>, <span class="dv">1</span>)],[se(<span class="dv">1</span>, <span class="dv">0</span>), se(<span class="dv">1</span>, <span class="dv">1</span>)]])</span>
<span id="cb1-6"><a></a>S1e</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="2">
<p><span class="math inline">\(\displaystyle \left[\begin{matrix}\frac{1}{h} &amp; - \frac{1}{h}\\- \frac{1}{h} &amp; \frac{1}{h}\end{matrix}\right]\)</span></p>
</div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>For Lagrange basis functions using just a few nodes the Sympy functions in the <code>lagrange.py</code> module are robust and efficient.</p>
</div>
</div>
</div>
<div class="fragment">
<div id="16775d1b" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a>l <span class="op">=</span> Lagrangebasis([<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>]) <span class="co"># 3 nodes per element</span></span>
<span id="cb2-2"><a></a>S2e <span class="op">=</span> <span class="dv">2</span><span class="op">/</span>h<span class="op">*</span>sp.Matrix(np.array([[se(i, j) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)]]).reshape(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb2-3"><a></a>S2e</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="3">
<p><span class="math inline">\(\displaystyle \left[\begin{matrix}\frac{7}{3 h} &amp; - \frac{8}{3 h} &amp; \frac{1}{3 h}\\- \frac{8}{3 h} &amp; \frac{16}{3 h} &amp; - \frac{8}{3 h}\\\frac{1}{3 h} &amp; - \frac{8}{3 h} &amp; \frac{7}{3 h}\end{matrix}\right]\)</span></p>
</div>
</div>
</div>
</section>
<section id="completely-generic-implementation-for-any-matrix" class="slide level2 smaller">
<h2>Completely generic implementation for any matrix</h2>
<p>The generic matrix</p>
<p><span class="math display">\[
q^{(m,n)}_{ij} = \left(\frac{d^n \psi_j}{dx^n}, \frac{d^m \psi_i}{dx^m} \right)
\]</span></p>
<p>requires the generic element matrix</p>
<p><span class="math display">\[
\tilde{q}^{(e,m,n)}_{rs} =  \int_{\Omega^{(e)}} \frac{d^n \psi_{q(e, s)}}{dx^n} \frac{d^m \psi_{q(e, r)}}{dx^m}  dx
\]</span></p>
<p>We can now use that</p>
<p><span class="math display">\[
\frac{d^n \psi_{q(e, r)}}{dx^n} = \frac{d^{n-1} }{dx^{n-1}}\left(\frac{d \psi_{q(e,r)}}{dx} \right) = \frac{d^{n-1}}{dx^{n-1}}\left( \frac{d \ell_r}{dX}\frac{dX}{dx}\right) = \frac{2}{h} \frac{d^{n-1}}{dx^{n-1}}\left( \frac{d \ell_r}{dX} \right)
\]</span></p>
<p>which recursively leads to</p>
<p><span class="math display">\[
\frac{d^n \psi_{q(e, r)}}{dx^n} = \left(\frac{2}{h}\right)^n \frac{d^n \ell_r}{dX^n}
\]</span></p>
</section>
<section id="generic-element-matrix" class="slide level2 smaller">
<h2>Generic element matrix</h2>
<p><span class="math display">\[
\tilde{q}^{(e,m,n)}_{rs} =  \int_{\Omega^{(e)}} \frac{d^n \psi_{q(e, s)}}{dx^n} \frac{d^m \psi_{q(e, r)}}{dx^m}  dx \quad \text{and} \quad \frac{d^n \psi_{q(e, r)}}{dx^n} = \left(\frac{2}{h}\right)^n \frac{d^n \ell_r}{dX^n}
\]</span></p>
<p>leads to</p>
<p><span class="math display">\[
\tilde{q}^{(e,m,n)}_{rs} = \left(\frac{h}{2}\right)^{1-(m+n)} \int_{-1}^1 \ell^{(n)}_s(X) \ell^{(m)}_r(X)  dX,
\]</span></p>
<p>where <span class="math inline">\(\ell^{(n)}_r = \frac{d^{n} \ell_r}{dX^n}\)</span>.</p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>This represents all the element matrices you will ever need, and it is easily implemented using a few lines of Sympy code.</p>
</div>
</div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Higher order of the derivatives <span class="math inline">\((m, n)\)</span> requires higher order elements. Remember, piecewise linear elements can only be differentiated once.</p>
</div>
</div>
</div>
</section>
<section id="sympy-implementation-of-generic-element-matrix" class="slide level2 smaller">
<h2>Sympy implementation of generic element matrix</h2>
<p>Using uniform nodes</p>
<p><span class="math display">\[
X_j = -1 + \frac{2j}{d}, \quad j=0,1,\ldots, d
\]</span></p>
<div id="8728fb1b" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a>Xj <span class="op">=</span> <span class="kw">lambda</span> d: np.array([sp.Rational(<span class="dv">2</span><span class="op">*</span>i, d) <span class="cf">for</span> i <span class="kw">in</span> np.arange(d<span class="op">+</span><span class="dv">1</span>)])<span class="op">-</span><span class="dv">1</span> </span>
<span id="cb3-2"><a></a>qe <span class="op">=</span> <span class="kw">lambda</span> l, r, s, m, n: sp.integrate(l[r].diff(x, m)<span class="op">*</span>l[s].diff(x, n), (x, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb3-3"><a></a><span class="kw">def</span> Qe(d<span class="op">=</span><span class="dv">1</span>, m<span class="op">=</span><span class="dv">0</span>, n<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb3-4"><a></a>    A <span class="op">=</span> np.zeros((d<span class="op">+</span><span class="dv">1</span>, d<span class="op">+</span><span class="dv">1</span>), dtype<span class="op">=</span><span class="bu">object</span>)</span>
<span id="cb3-5"><a></a>    l <span class="op">=</span> Lagrangebasis(Xj(d))</span>
<span id="cb3-6"><a></a>    <span class="cf">for</span> r <span class="kw">in</span> <span class="bu">range</span>(d<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb3-7"><a></a>        <span class="cf">for</span> s <span class="kw">in</span> <span class="bu">range</span>(d<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb3-8"><a></a>            A[r, s] <span class="op">=</span> qe(l, r, s, m, n)</span>
<span id="cb3-9"><a></a>    <span class="cf">return</span> (h<span class="op">/</span><span class="dv">2</span>)<span class="op">**</span>(<span class="dv">1</span><span class="op">-</span>m<span class="op">-</span>n)<span class="op">*</span>sp.Matrix(A)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column">
<div id="095a84d8" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a>Qe(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="5">
<p><span class="math inline">\(\displaystyle \left[\begin{matrix}\frac{7}{3 h} &amp; - \frac{8}{3 h} &amp; \frac{1}{3 h}\\- \frac{8}{3 h} &amp; \frac{16}{3 h} &amp; - \frac{8}{3 h}\\\frac{1}{3 h} &amp; - \frac{8}{3 h} &amp; \frac{7}{3 h}\end{matrix}\right]\)</span></p>
</div>
</div>
</div><div class="column">
<div id="19dc7514" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a>Qe(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="6">
<p><span class="math inline">\(\displaystyle \left[\begin{matrix}\frac{81}{h^{3}} &amp; - \frac{405}{2 h^{3}} &amp; \frac{162}{h^{3}} &amp; - \frac{81}{2 h^{3}}\\- \frac{405}{2 h^{3}} &amp; \frac{567}{h^{3}} &amp; - \frac{1053}{2 h^{3}} &amp; \frac{162}{h^{3}}\\\frac{162}{h^{3}} &amp; - \frac{1053}{2 h^{3}} &amp; \frac{567}{h^{3}} &amp; - \frac{405}{2 h^{3}}\\- \frac{81}{2 h^{3}} &amp; \frac{162}{h^{3}} &amp; - \frac{405}{2 h^{3}} &amp; \frac{81}{h^{3}}\end{matrix}\right]\)</span></p>
</div>
</div>
</div></div>
</section>
<section id="assemble-the-generic-matrix-qmn" class="slide level2 smaller">
<h2>Assemble the generic matrix <span class="math inline">\(Q^{(m,n)}\)</span></h2>
<p><span class="math display">\[
q^{(m, n)}_{ij} = \int_{\Omega} \psi^{(n)}_j \psi^{(m)}_i dx
\]</span></p>
<ul>
<li>For all elements <span class="math inline">\(e=0,\ldots, N_e-1\)</span>
<ul>
<li>For all <span class="math inline">\(r=0,\ldots, d\)</span>
<ul>
<li>For all <span class="math inline">\(s=0, \ldots, d\)</span></li>
</ul></li>
</ul></li>
</ul>
<p><span class="math display">\[
            q^{(m,n)}_{q(e,r),q(e,s)} += \tilde{q}^{(e,m,n)}_{rs}
\]</span></p>
</section>
<section id="implementation-1" class="slide level2 smaller">
<h2>Implementation</h2>
<div id="99b04513" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a><span class="im">from</span> fem <span class="im">import</span> get_element_boundaries, get_element_length, local_to_global_map, map_u_true_domain, fe_evaluate_v</span>
<span id="cb6-2"><a></a></span>
<span id="cb6-3"><a></a><span class="kw">def</span> assemble_q(xj, d<span class="op">=</span><span class="dv">1</span>, m<span class="op">=</span><span class="dv">0</span>, n<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb6-4"><a></a>    N <span class="op">=</span> <span class="bu">len</span>(xj)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb6-5"><a></a>    Ne <span class="op">=</span> N<span class="op">//</span>d</span>
<span id="cb6-6"><a></a>    A <span class="op">=</span> np.zeros((N<span class="op">+</span><span class="dv">1</span>, N<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb6-7"><a></a>    Q <span class="op">=</span> Qe(d, m, n)</span>
<span id="cb6-8"><a></a>    <span class="cf">for</span> elem <span class="kw">in</span> <span class="bu">range</span>(Ne):</span>
<span id="cb6-9"><a></a>        hj <span class="op">=</span> get_element_length(xj, elem, d<span class="op">=</span>d)</span>
<span id="cb6-10"><a></a>        s0 <span class="op">=</span> local_to_global_map(elem, d<span class="op">=</span>d)</span>
<span id="cb6-11"><a></a>        A[s0, s0] <span class="op">+=</span> np.array(Q.subs(h, hj), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb6-12"><a></a>    <span class="cf">return</span> A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create mesh and assemble any generic, numerical matrix:</p>
<div class="columns">
<div class="column">
<h3 id="q11-using-d1-n6"><span class="math inline">\(Q^{(1,1)}\)</span> using <span class="math inline">\(d=1, N=6\)</span></h3>
<div id="b7892882" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a>N <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb7-2"><a></a>xj <span class="op">=</span> np.linspace(<span class="dv">1</span>, <span class="dv">2</span>, N<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb7-3"><a></a>S <span class="op">=</span> assemble_q(xj, d<span class="op">=</span><span class="dv">1</span>, m<span class="op">=</span><span class="dv">1</span>, n<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-4"><a></a><span class="bu">print</span>(S) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 6. -6.  0.  0.  0.  0.  0.]
 [-6. 12. -6.  0.  0.  0.  0.]
 [ 0. -6. 12. -6.  0.  0.  0.]
 [ 0.  0. -6. 12. -6.  0.  0.]
 [ 0.  0.  0. -6. 12. -6.  0.]
 [ 0.  0.  0.  0. -6. 12. -6.]
 [ 0.  0.  0.  0.  0. -6.  6.]]</code></pre>
</div>
</div>
</div><div class="column">
<h3 id="q22-using-d2-n6"><span class="math inline">\(Q^{(2,2)}\)</span> using <span class="math inline">\(d=2, N=6\)</span></h3>
<div id="7298be81" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a>N <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb9-2"><a></a>xj <span class="op">=</span> np.linspace(<span class="dv">1</span>, <span class="dv">2</span>, N<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb9-3"><a></a>Q <span class="op">=</span> assemble_q(xj, d<span class="op">=</span><span class="dv">2</span>, m<span class="op">=</span><span class="dv">2</span>, n<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb9-4"><a></a><span class="bu">print</span>(Q) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 432. -864.  432.    0.    0.    0.    0.]
 [-864. 1728. -864.    0.    0.    0.    0.]
 [ 432. -864.  864. -864.  432.    0.    0.]
 [   0.    0. -864. 1728. -864.    0.    0.]
 [   0.    0.  432. -864.  864. -864.  432.]
 [   0.    0.    0.    0. -864. 1728. -864.]
 [   0.    0.    0.    0.  432. -864.  432.]]</code></pre>
</div>
</div>
</div></div>
</section>
<section id="solve-any-linear-differential-equation" class="slide level2 smaller">
<h2>Solve any linear differential equation</h2>
<p>For example the Helmholtz equation: <span class="math display">\[
u''+\alpha u = f, \quad x \in (0, 10)
\]</span></p>
<p>Find <span class="math inline">\(u_N \in V_N\)</span> such that</p>
<p><span class="math display">\[
-(u'_N, v') + \alpha (u_N, v) = (f, v) - [u'_Nv]_{x=0}^{x=10}, \quad \forall \, v \in V_N
\]</span></p>
<p>Assume manufactured solution <span class="math inline">\(u(x)=J_0(x)\)</span>, where <span class="math inline">\(J_0(x)\)</span> is the 0 order Bessel function of the first kind. Use Dirichlet boundary conditions, <span class="math inline">\(u(0)=J_0(0)\)</span> and <span class="math inline">\(u(10)=J_0(10)\)</span>, and thus neglect <span class="math inline">\([u'_Nv]_{x=0}^{x=10}\)</span>.</p>
<div id="058a21cc" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a>N <span class="op">=</span> <span class="dv">20</span> </span>
<span id="cb11-2"><a></a>xj <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, N<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb11-3"><a></a>d <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb11-4"><a></a>S <span class="op">=</span> assemble_q(xj, d<span class="op">=</span>d, m<span class="op">=</span><span class="dv">1</span>, n<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb11-5"><a></a>M <span class="op">=</span> assemble_q(xj, d<span class="op">=</span>d, m<span class="op">=</span><span class="dv">0</span>, n<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb11-6"><a></a>alpha <span class="op">=</span> <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math display">\[
(-S + \alpha M)\boldsymbol{\hat{u}} = \boldsymbol{b}
\]</span></p>
</section>
<section id="assemble-right-hand-side-and-solve" class="slide level2 smaller">
<h2>Assemble right hand side and solve</h2>
<div id="e22f217c" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a>ue <span class="op">=</span> sp.besselj(<span class="dv">0</span>, x)</span>
<span id="cb12-2"><a></a>f <span class="op">=</span> ue.diff(x, <span class="dv">2</span>) <span class="op">+</span> alpha<span class="op">*</span>ue</span>
<span id="cb12-3"><a></a><span class="kw">def</span> assemble_b(u, xj, d<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb12-4"><a></a>    l <span class="op">=</span> Lagrangebasis(np.linspace(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, d<span class="op">+</span><span class="dv">1</span>), sympy<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-5"><a></a>    N <span class="op">=</span> <span class="bu">len</span>(xj)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb12-6"><a></a>    b <span class="op">=</span> np.zeros(N<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb12-7"><a></a>    <span class="cf">for</span> elem <span class="kw">in</span> <span class="bu">range</span>(N<span class="op">//</span>d):</span>
<span id="cb12-8"><a></a>        hj <span class="op">=</span> get_element_length(xj, elem, d<span class="op">=</span>d)</span>
<span id="cb12-9"><a></a>        us <span class="op">=</span> sp.lambdify(x, map_u_true_domain(u, xj, elem, d<span class="op">=</span>d))</span>
<span id="cb12-10"><a></a>        integ <span class="op">=</span> <span class="kw">lambda</span> xj, r: us(xj)<span class="op">*</span>l[r](xj)</span>
<span id="cb12-11"><a></a>        <span class="cf">for</span> r <span class="kw">in</span> <span class="bu">range</span>(d<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb12-12"><a></a>            b[d<span class="op">*</span>elem<span class="op">+</span>r] <span class="op">+=</span> hj<span class="op">/</span><span class="dv">2</span><span class="op">*</span>quad(integ, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, args<span class="op">=</span>(r,))[<span class="dv">0</span>]</span>
<span id="cb12-13"><a></a>    <span class="cf">return</span> b</span>
<span id="cb12-14"><a></a>b <span class="op">=</span> assemble_b(f, xj, d<span class="op">=</span>d)</span>
<span id="cb12-15"><a></a>b[<span class="dv">0</span>], b[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> ue.subs(x, <span class="dv">0</span>), ue.subs(x, <span class="dv">10</span>)    <span class="co"># specify u(0) and u(L)</span></span>
<span id="cb12-16"><a></a>A <span class="op">=</span> <span class="op">-</span>S<span class="op">+</span>alpha<span class="op">*</span>M</span>
<span id="cb12-17"><a></a>A[<span class="dv">0</span>, :] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> A[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span>    <span class="co"># ident first row for bc at u(0)</span></span>
<span id="cb12-18"><a></a>A[<span class="op">-</span><span class="dv">1</span>, :] <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> A[<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span> <span class="co"># ident last row for bc at u(L)</span></span>
<span id="cb12-19"><a></a>uh <span class="op">=</span> np.linalg.solve(A, b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e4f28587" class="cell" data-execution_count="13">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="fempdes_files/figure-revealjs/cell-13-output-1.png" width="805" height="263"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="use-neumann-boundary-conditions-instead" class="slide level2 smaller">
<h2>Use Neumann boundary conditions instead</h2>
<p>Find <span class="math inline">\(u_N \in V_N\)</span> such that</p>
<p><span class="math display">\[
-(u'_N, v') + \alpha (u_N, v) = (f, v) - [u'_Nv]_{x=0}^{x=10}, \quad \forall \, v \in V_N
\]</span></p>
<p>Insert for boundary conditions <span class="math inline">\(u'(0)=J'_0(0)\)</span> and <span class="math inline">\(u'(10)=J'_0(10)\)</span></p>
<p><span class="math display">\[
-(u'_N, \psi_i') + \alpha (u_N, \psi_i) = (f, \psi_i) - (J'_0(10)\psi_i(10) - J'_0(10) \psi_i(0)), \quad i=0, 1, \ldots, N
\]</span></p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>The boundary term <span class="math inline">\(J'_0(10)\psi_i(10)\)</span> is only nonzero for <span class="math inline">\(i=N\)</span> and <span class="math inline">\(J'_0(0) \psi_i(0)\)</span> is only nonzero for <span class="math inline">\(i=0\)</span>. This follows since <span class="math inline">\(\psi_i(x_j) = \delta_{ij}\)</span> and <span class="math inline">\(x_0=0\)</span> and <span class="math inline">\(x_N=10\)</span>.</p>
</div>
</div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>The term <span class="math inline">\((J'_0(10)\psi_i(10) - J'_0(0) \psi_i(0))\)</span> goes into <span class="math inline">\(\boldsymbol{b}\)</span>, because it is a linear form containing the test function <span class="math inline">\(\psi_i\)</span> but not the trial function <span class="math inline">\(\psi_j\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="solve" class="slide level2 smaller">
<h2>Solve</h2>
<p>The coefficient matrix <span class="math inline">\(-S+\alpha M\)</span> is unmodified (no identing first/last rows) and the right hand side <span class="math inline">\(\boldsymbol{b}\)</span> takes care of the Neumann boundary conditions</p>
<p><span class="math display">\[
(-S+\alpha M)\boldsymbol{\hat{u}} = \boldsymbol{b} = \begin{bmatrix}
(f, \psi_0)+J'_0(0) \\
(f, \psi_1) \\
\vdots \\
(f, \psi_{N-1}) \\
(f, \psi_N) - J'_0(10)
\end{bmatrix}
\]</span></p>
<div id="8f5a0d27" class="cell columns column-output-location" data-execution_count="14">
<div class="column">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a>S <span class="op">=</span> assemble_q(xj, d, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb13-2"><a></a>M <span class="op">=</span> assemble_q(xj, d, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb13-3"><a></a>b <span class="op">=</span> assemble_b(f, xj, d<span class="op">=</span>d)</span>
<span id="cb13-4"><a></a>b[<span class="dv">0</span>] <span class="op">+=</span> ue.diff(x, <span class="dv">1</span>).subs(x, <span class="dv">0</span>).n()    <span class="co"># specify u'(0)</span></span>
<span id="cb13-5"><a></a>b[<span class="op">-</span><span class="dv">1</span>] <span class="op">-=</span> ue.diff(x, <span class="dv">1</span>).subs(x, <span class="dv">10</span>).n()  <span class="co"># specify u'(L)</span></span>
<span id="cb13-6"><a></a>uh <span class="op">=</span> np.linalg.solve(<span class="op">-</span>S<span class="op">+</span>alpha<span class="op">*</span>M, b)</span>
<span id="cb13-7"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">3</span>))</span>
<span id="cb13-8"><a></a>plt.plot(xj, uh)</span>
<span id="cb13-9"><a></a>plt.plot(xj, sp.lambdify(x, ue)(xj), <span class="st">'k:'</span>)</span>
<span id="cb13-10"><a></a>plt.legend([<span class="ss">f'FEM d=1 N=</span><span class="sc">{</span>N<span class="sc">}</span><span class="ss">'</span>, <span class="st">'Exact'</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="fempdes_files/figure-revealjs/cell-14-output-1.png" width="805" height="263"></p>
</figure>
</div>
</div>
</div></div>
</section>
<section id="fem-in-multiple-dimensions" class="slide level2 smaller">
<h2>FEM in multiple dimensions</h2>
<p>Basis functions are usually multidimensional</p>
<p><span class="math display">\[
u_N(x, y, z) = \sum_{j=0}^N \hat{u}_j \psi_j(x, y, z)
\]</span></p>
<p>The Galerkin method is exactly the same: Find <span class="math inline">\(u_N \in V_N (=\text{span}\{\psi_j\}_{j=0}^N)\)</span> such that</p>
<p><span class="math display">\[
(\mathcal{L}(u_N)-f, v) = 0, \quad \forall \, v \in V_N
\]</span></p>
<p>But naturally the method is harder to implement. We need to use position vectors in real and reference space</p>
<p><span class="math display">\[
\boldsymbol{x} = x \boldsymbol{i} + y \boldsymbol{j} + z \boldsymbol{k} \quad \text{and} \quad \boldsymbol{X} = X \boldsymbol{i} + Y \boldsymbol{j} + Z \boldsymbol{k}
\]</span></p>
<p><span class="math display">\[
\text{Map basis functions: } \psi_j(\boldsymbol{x}) = \tilde{\psi}_j(\boldsymbol{X})
\]</span></p>
<p><span class="math display">\[
\text{Global nodes: } \boldsymbol{x}_i = (x_i, y_i, z_i), \quad i=0,1, \ldots, N
\]</span></p>
<p><span class="math display">\[
\text{Local nodes for triangles: }\boldsymbol{X}_r = (X_r, Y_r, Z_r), \quad r=0, 1, 2
\]</span></p>
</section>
<section id="the-tent-basis-functions-in-2d" class="slide level2 smaller">
<h2>The tent basis functions in 2D</h2>
<p>The Lagrange basis functions are still defined by</p>
<p><span class="math display">\[
\psi_j(\boldsymbol{x}_i) = \delta_{ij}
\]</span></p>
<p>and for 2D the piecewise linear basis function now look like “tents”</p>

<img data-src="./figures/demo2D_basisfunc.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="reference-triangle-and-reference-basis-functions" class="slide level2 smaller">
<h2>Reference triangle and reference basis functions</h2>
<div id="e7145c26" class="cell" data-execution_count="15">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="fempdes_files/figure-revealjs/cell-15-output-1.png" class="quarto-figure quarto-figure-center" width="763" height="326"></p>
</figure>
</div>
</div>
</div>
<p>The reference triangle has three nodes <span class="math inline">\(\boldsymbol{X}_0= (0, 0), \boldsymbol{X}_1= (1, 0)\)</span> and <span class="math inline">\(\boldsymbol{X}_2 = (0, 1)\)</span>, and the three nonzero, linear reference basis functions on this element are</p>
<p><span class="math display">\[
\tilde{\psi}_0(X, Y) = 1-X-Y, \quad \tilde{\psi}_1(X, Y) = X, \quad \tilde{\psi}_2(X, Y) = Y
\]</span></p>
<p><span class="math display">\[
\psi_{q(e, r)}(\boldsymbol{x}) = \tilde{\psi}_r(\boldsymbol{X}) \quad \text{and} \quad  \boldsymbol{x}(\boldsymbol{X}) = \sum_{r} \tilde{\psi}_r(\boldsymbol{X}) \boldsymbol{x}_{q(e, r)}
\]</span></p>
</section>
<section id="visualization-of-basis-functions-on-reference-triangle" class="slide level2 smaller">
<h2>Visualization of basis functions on reference triangle</h2>
<div id="3216b48a" class="cell" data-execution_count="16">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="fempdes_files/figure-revealjs/cell-16-output-1.png" width="1162" height="406"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="p2-elements" class="slide level2 smaller">
<h2>P2 elements</h2>
<div id="267c455e" class="cell" data-execution_count="17">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="fempdes_files/figure-revealjs/cell-17-output-1.png" class="quarto-figure quarto-figure-center" width="763" height="301"></p>
</figure>
</div>
</div>
</div>
<p><span class="math display">\[
\{\boldsymbol{X}_i\}_{i=0}^5=[(0, 0), (1, 0), (0, 1), (0.5, 0), (0.5, 0.5), (0, 0.5)]
\]</span></p>
<p><span class="math display">\[
\tilde{\psi}_r(\boldsymbol{X}_s) = \delta_{rs}, \quad (r, s) \in (0, 1, \ldots, 5)^2
\]</span></p>
<p><span class="math display">\[
\tilde{\psi}_r(X, Y) = a^r_0 + a^r_1 X + a^r_2 Y + a^r_3 X^2 + a^r_4 XY + a^r_5 Y^2
\]</span></p>
</section>
<section id="p2-basis-functions" class="slide level2 smaller">
<h2>P2 basis functions</h2>
<p>For each <span class="math inline">\(r\in(0, 1, \ldots, 5)\)</span> solve for <span class="math inline">\(\{a^r_s\}_{s=0}^5\)</span> in</p>
<p><span class="math display">\[
\tilde{\psi}_r(X, Y) = a^r_0 + a^r_1 X + a^r_2 Y + a^r_3 X^2 + a^r_4 XY + a^r_5 Y^2
\]</span></p>
<p>such that the 6 equations <span class="math inline">\(\tilde{\psi}_r({X}_s, Y_s) = \delta_{rs}, s=0,1,\ldots, 5\)</span>, are satisfied.</p>
<div class="fragment">
<p>The basis functions are then found as</p>
<p><span class="math display">\[
\begin{align}
\tilde{\psi}_0(X, Y) &amp;= 1-3X-3Y + 2X^2 + 4XY+2Y^2 \\
\tilde{\psi}_1(X, Y) &amp;= X (2X-1) \\
\tilde{\psi}_2(X, Y) &amp;= Y(2Y-1)\\
\tilde{\psi}_3(X, Y) &amp;= 4X (1-X-Y) \\
\tilde{\psi}_4(X, Y) &amp;= 4XY \\
\tilde{\psi}_5(X, Y) &amp;= 4Y (1-X-Y)
\end{align}
\]</span></p>
</div>
</section>
<section id="visualization-of-p2-basis-functions" class="slide level2 smaller">
<h2>Visualization of P2 basis functions</h2>
<div id="548221c9" class="cell" data-execution_count="18">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="fempdes_files/figure-revealjs/cell-18-output-1.png" width="1018" height="582"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="greens-first-identity" class="slide level2 smaller">
<h2>Green’s first identity</h2>
<p>In order to use piecewise linear (P1) elements for Poisson’s equation we need to use the “multidimensional integration by parts”</p>
<p><span class="math display">\[
\int_{\Omega} \nabla^2 u \,v \,d\Omega = -\int_{\Omega} \nabla u \cdot \nabla v \, d \Omega + \oint_{\partial \Omega} \nabla u \cdot \boldsymbol{n} \, v \, d \sigma,
\]</span></p>
<p>where <span class="math inline">\(\partial \Omega\)</span> is the enclosing boundary of the domain <span class="math inline">\(\Omega\)</span>, <span class="math inline">\(\boldsymbol{n}\)</span> is an outward pointing unit normal vector and <span class="math inline">\(d\sigma\)</span> is a line element in 2D and a surface element in 3D. With <span class="math inline">\(L^2\)</span> inner product notation:</p>
<p><span class="math display">\[
(\nabla^2 u, v)_{L^2(\Omega)} = - (\nabla u, \nabla v)_{L^2(\Omega)} + (\nabla u \cdot \boldsymbol{n}, v)_{L^2(\partial \Omega)}.
\]</span></p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Piecewise linear basis functions have only one nonzero derivative in each direction. So for P1 elements <span class="math inline">\((\nabla^2u, v)=0\)</span>, but <span class="math inline">\((\nabla u, \nabla v)\)</span> may be nonzero.</p>
</div>
</div>
</div>
</section>
<section id="assembly-on-the-reference-domain" class="slide level2 smaller">
<h2>Assembly on the reference domain</h2>
<div id="0bc74989" class="cell" data-execution_count="19">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="fempdes_files/figure-revealjs/cell-19-output-1.png" class="quarto-figure quarto-figure-center" width="587" height="256"></p>
</figure>
</div>
</div>
</div>
<p><span class="math display">\[ \small
\int_{\Omega^{(e)}} \psi_j(\boldsymbol{x}) \cdot \psi_i(\boldsymbol{x}) \, d\Omega = \int_{\tilde{\Omega}} \tilde{\psi}_s(\boldsymbol{X}) \cdot \tilde{\psi}_r(\boldsymbol{X}) \det J d\tilde{\Omega}
\]</span></p>
<p>We here use the Jacobian <span class="math inline">\(J\)</span> of the transformation, defined such that <span class="math display">\[ \small
(J)_{ij} = \frac{\partial x_j}{\partial X_i}, \quad (J^{-1})_{ij} = \frac{\partial X_j}{\partial x_i}
\]</span></p>
<p><span class="math display">\[
\text{2D Cartesian mesh: } \quad d\Omega = dxdy, \quad d\tilde{\Omega} = dXdY, \quad \det J = \frac{\partial x}{\partial X}\frac{\partial y}{\partial Y} - \frac{\partial x}{\partial Y}\frac{\partial y}{\partial X}
\]</span></p>
</section>
<section id="stiffness-matrix" class="slide level2 smaller">
<h2>Stiffness matrix</h2>
<p><span class="math display">\[
\int_{\Omega^{(e)}} \nabla \psi_j(\boldsymbol{x}) \cdot \nabla \psi_i(\boldsymbol{x}) \, d\Omega
\]</span></p>
<p>The gradient of <span class="math inline">\(\psi_j\)</span> on index form is <span class="math display">\[
(\nabla \psi_j)_i = \frac{\partial \psi_j}{ \partial x_i}
\]</span></p>
<p>and with transformation to the reference domain (with summation on repeated indices)</p>
<p><span class="math display">\[
\frac{\partial \psi_{q(e, r)}(\boldsymbol{x})}{\partial x_i} =\frac{\partial \tilde{\psi}_r(\boldsymbol{X})}{\partial x_i} = \frac{\partial \tilde{\psi}_r}{\partial X_j}\frac{\partial X_j}{\partial x_i}
\]</span></p>
<p>Using the inverse Jacobian we can write the last term as</p>
<p><span class="math display">\[
\frac{\partial \tilde{\psi}_r}{\partial X_j}\frac{\partial X_j}{\partial x_i} = J_{ij}^{-1}  \frac{\partial \tilde{\psi}_r}{\partial X_j}
\]</span></p>
</section>
<section id="stiffness-matrix-continued" class="slide level2 smaller">
<h2>Stiffness matrix continued</h2>
<p>We can also define this on matrix form using notation</p>
<p><span class="math display">\[
\nabla  u= \begin{bmatrix} \frac{\partial u}{\partial x} \\[0.1cm]
\frac{\partial u}{\partial y} \\[0.1cm]
\frac{\partial u}{\partial z}
\end{bmatrix} \quad \text{and} \quad  
\nabla_X  u = \begin{bmatrix} \frac{\partial u}{\partial X} \\[0.1cm]
\frac{\partial u}{\partial Y} \\[0.1cm]
\frac{\partial u}{\partial Z} \end{bmatrix}
\]</span></p>
<p>We then get</p>
<p><span class="math display">\[
\nabla \psi_{q(e, r)} = J^{-1} \cdot \nabla_X \tilde{\psi}_r
\]</span></p>
<p>and the stiffness matrix</p>
<p><span class="math display">\[
\boxed{
\int_{\Omega^{(e)}} \nabla \psi_{q(e, s)}(\boldsymbol{x}) \cdot \nabla \psi_{q(e, r)}(\boldsymbol{x}) \, d\Omega = \int_{\tilde{\Omega}} \left(J^{-1} \cdot \nabla_X \tilde{\psi}_s(\boldsymbol{X})\right) \cdot \left(J^{-1} \cdot \nabla_X \tilde{\psi}_r(\boldsymbol{X})\right) \, \text{det}J\, d\tilde{\Omega}}
\]</span></p>
</section>
<section id="implementation-2" class="slide level2 smaller">
<h2>Implementation</h2>
<div class="columns">
<div class="column">
<p>For each triangle in the mesh we have</p>
<ul>
<li><p>A local to global map, mapping local element number and node <span class="math inline">\(e, r\)</span> to global nodes <span class="math inline">\(q(e, r)\)</span></p></li>
<li><p>The three nodes <span class="math inline">\(\boldsymbol{x}_{q(e, r)}\)</span> for <span class="math inline">\(r=0,1,2\)</span></p></li>
<li><p>A coordinate map: <span class="math inline">\(\boldsymbol{x}(\boldsymbol{X}) = \sum_{r} \tilde{\psi}_r(\boldsymbol{X}) \boldsymbol{x}_{q(e, r)}\)</span>, where <span class="math inline">\(\begin{align} \tilde{\psi}_0(X, Y) &amp;= 1-X-Y \\ \tilde{\psi}_1(X, Y) &amp;= X \\ \tilde{\psi}_2(X, Y) &amp;= Y \end{align}\)</span></p></li>
</ul>
</div><div class="column">
<div id="7ea32b77" class="cell" data-execution_count="20">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="fempdes_files/figure-revealjs/cell-20-output-1.png" width="763" height="389"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p>From this we can easily compute the Jacobian</p>
<p><span class="math display">\[
J_{ij} = \frac{\partial x_j}{\partial X_i} = \sum_{r=0}^2 \frac{\partial \tilde{\psi}_r}{\partial X_i} (\boldsymbol{x}_{q(e, r)})_j\]</span></p>
</section>
<section id="for-each-triangle-compute-the-jacobian" class="slide level2 smaller">
<h2>For each triangle compute the Jacobian</h2>
<p><span class="math display">\[
J_{ij} = \frac{\partial x_j}{\partial X_i} = \sum_{r=0}^2 \frac{\partial \tilde{\psi}_r}{\partial X_i} (\boldsymbol{x}_{q(e, r)})_j\]</span></p>
<p><span class="math display">\[
\nabla_X \tilde{\psi} = \underbrace{\begin{bmatrix} \frac{\partial \tilde{\psi}_0}{\partial X} &amp; \frac{\partial \tilde{\psi}_1}{\partial X} &amp; \frac{\partial \tilde{\psi}_2}{\partial X} \\[0.1cm]
\frac{\partial \tilde{\psi}_0}{\partial Y} &amp; \frac{\partial \tilde{\psi}_1}{\partial Y} &amp; \frac{\partial \tilde{\psi}_2}{\partial Y} \\[0.1cm] \end{bmatrix}}_{\mathbb{R}^{2 \times 3}} \quad \text{and} \quad \boldsymbol{x}_{q(e)} = \underbrace{\begin{bmatrix} (\boldsymbol{x}_{q(e, 0)})_0 &amp; (\boldsymbol{x}_{q(e, 0)})_1 \\
(\boldsymbol{x}_{q(e, 1)})_0 &amp; (\boldsymbol{x}_{q(e, 1)})_1 \\
(\boldsymbol{x}_{q(e, 2)})_0 &amp; (\boldsymbol{x}_{q(e, 2)})_1
  \end{bmatrix}}_{\mathbb{R}^{3 \times 2}}
\]</span></p>
<p>Note that <span class="math inline">\(\tilde{\psi}_r\)</span> here are the <strong>linear</strong> basis functions, such that</p>
<p><span class="math display">\[
\begin{align} \tilde{\psi}_0(X, Y) &amp;= 1-X-Y \\ \tilde{\psi}_1(X, Y) &amp;= X \\ \tilde{\psi}_2(X, Y) &amp;= Y \end{align} \quad \rightarrow \nabla_X \tilde{\psi} = \begin{bmatrix} -1 &amp; 1 &amp; 0 \\ -1 &amp; 0 &amp; 1 \end{bmatrix}
\]</span></p>
<p><span class="math display">\[
\boxed{J = \nabla_X \tilde{\psi} \cdot \boldsymbol{x}_{q(e)} \in \mathbb{R}^{2 \times 2} }
\]</span></p>
</section>
<section id="implementation-summary" class="slide level2 smaller">
<h2>Implementation summary</h2>
<ul>
<li><p>For each element collect the true coordinates of the nodes <span class="math inline">\(\boldsymbol{x}_{q(e)}\)</span></p></li>
<li><p>Use a precomputed matrix <span class="math inline">\(\nabla_X \tilde{\psi}\)</span> and compute the Jacobian <span class="math inline">\(J\)</span></p></li>
<li><p>Compute the inverse of the Jacobian <span class="math inline">\(J^{-1}\)</span></p></li>
<li><p>Assemble element matrix, for example stiffness <span class="math display">\[
\int_{\Omega^{(e)}} \nabla \psi_{q(e, s)}(\boldsymbol{x}) \cdot \nabla \psi_{q(e, r)}(\boldsymbol{x}) \, d\Omega = \int_{\tilde{\Omega}} \left(J^{-1} \cdot \nabla_X \tilde{\psi}_s(\boldsymbol{X})\right) \cdot \left(J^{-1} \cdot \nabla_X \tilde{\psi}_r(\boldsymbol{X})\right) \, \text{det}J\, d\tilde{\Omega}
\]</span> For piecewise linear elements the integrand is a constant and you only need to compute the area of each cell. For higher order elements the integral requires some work!</p></li>
<li><p>Add element matrix to global matrix (finite element assembly). For all <span class="math inline">\(e\)</span> and <span class="math inline">\(r\)</span> and <span class="math inline">\(s\)</span> do <span class="math display">\[
a_{q(e, r), q(e, s)} \mathrel += \tilde{a}_{rs}
\]</span></p></li>
</ul>
</section>
<section id="example-for-simple-yet-unstructured-mesh" class="slide level2 smaller">
<h2>Example for simple, yet unstructured mesh</h2>
<div id="dbb92019" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a></a>xi <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb14-2"><a></a>xj, yj <span class="op">=</span> np.meshgrid(xi, xi, indexing<span class="op">=</span><span class="st">'ij'</span>)</span>
<span id="cb14-3"><a></a>nodes <span class="op">=</span> np.array([xj.flatten(), yj.flatten()])</span>
<span id="cb14-4"><a></a>elements <span class="op">=</span> {</span>
<span id="cb14-5"><a></a>    <span class="dv">0</span>: (<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">1</span>),</span>
<span id="cb14-6"><a></a>    <span class="dv">1</span>: (<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb14-7"><a></a>    <span class="dv">2</span>: (<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>),</span>
<span id="cb14-8"><a></a>    <span class="dv">3</span>: (<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">7</span>),</span>
<span id="cb14-9"><a></a>    <span class="dv">4</span>: (<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2</span>),</span>
<span id="cb14-10"><a></a>    <span class="dv">5</span>: (<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb14-11"><a></a>    <span class="dv">6</span>: (<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">5</span>),</span>
<span id="cb14-12"><a></a>    <span class="dv">7</span>: (<span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">8</span>)</span>
<span id="cb14-13"><a></a>}</span>
<span id="cb14-14"><a></a>xj, yj <span class="op">=</span> xj.flatten(), yj.flatten()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4a80ba2b" class="cell" data-execution_count="22">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="fempdes_files/figure-revealjs/cell-22-output-1.png" width="763" height="389"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="assemble-stiffness-matrix" class="slide level2 smaller">
<h2>Assemble stiffness matrix</h2>
<div id="7e7b2936" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a></a>A <span class="op">=</span> np.zeros((<span class="dv">9</span>, <span class="dv">9</span>)) </span>
<span id="cb15-2"><a></a>Ae <span class="op">=</span> np.zeros((<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb15-3"><a></a>dpsi <span class="op">=</span> np.array([[<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>], [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>]])</span>
<span id="cb15-4"><a></a><span class="cf">for</span> e, q <span class="kw">in</span> elements.items(): </span>
<span id="cb15-5"><a></a>    xq <span class="op">=</span> np.take(nodes, q, axis<span class="op">=</span><span class="dv">1</span>).T</span>
<span id="cb15-6"><a></a>    J <span class="op">=</span> dpsi <span class="op">@</span> xq</span>
<span id="cb15-7"><a></a>    detJ <span class="op">=</span> np.linalg.det(J)</span>
<span id="cb15-8"><a></a>    Ji <span class="op">=</span> np.linalg.inv(J)</span>
<span id="cb15-9"><a></a>    <span class="cf">for</span> r <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb15-10"><a></a>        <span class="cf">for</span> s <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb15-11"><a></a>            Ae[r, s] <span class="op">=</span> (Ji <span class="op">@</span> dpsi[:, r]) <span class="op">@</span> (Ji <span class="op">@</span> dpsi[:, s]) <span class="op">*</span> detJ <span class="op">*</span> <span class="fl">0.5</span></span>
<span id="cb15-12"><a></a>            A[q[r], q[s]] <span class="op">+=</span> Ae[r, s]</span>
<span id="cb15-13"><a></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>array([[ 1. , -0.5,  0. , -0.5,  0. ,  0. ,  0. ,  0. ,  0. ],
       [-0.5,  2. , -0.5,  0. , -1. ,  0. ,  0. ,  0. ,  0. ],
       [ 0. , -0.5,  1. ,  0. ,  0. , -0.5,  0. ,  0. ,  0. ],
       [-0.5,  0. ,  0. ,  2. , -1. ,  0. , -0.5,  0. ,  0. ],
       [ 0. , -1. ,  0. , -1. ,  4. , -1. ,  0. , -1. ,  0. ],
       [ 0. ,  0. , -0.5,  0. , -1. ,  2. ,  0. ,  0. , -0.5],
       [ 0. ,  0. ,  0. , -0.5,  0. ,  0. ,  1. , -0.5,  0. ],
       [ 0. ,  0. ,  0. ,  0. , -1. ,  0. , -0.5,  2. , -0.5],
       [ 0. ,  0. ,  0. ,  0. ,  0. , -0.5,  0. , -0.5,  1. ]])</code></pre>
</div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>A better implementation would use vectorization for the inner <span class="math inline">\(r, s\)</span> loops.</p>
</div>
</div>
</div>
</section>
<section id="summary" class="slide level2 smaller">
<h2>Summary</h2>
<ul>
<li>The finite element method is easily adapted to complex meshes consisting of triangles in 2D or tetrahedra in 3D.</li>
</ul>
<ul>
<li class="fragment">The implementation is mapping the true cells to reference triangles or tetrahedra. The mapping involves a Jacobian that is easy to compute from the linear Lagrange basis functions and cell nodes.</li>
<li class="fragment">Higher order elements use internal points on each element.</li>
<li class="fragment">Green’s first identity, which is similar to an integration by substitution in multiple dimensions, is used to transform weak variational forms.</li>
<li class="fragment">Neumann boundary conditions are implemented directly in the weak form.</li>
<li class="fragment">Dirichlet boundary conditions are implemented as always by identing rows in the coefficient matrix belonging to a Dirichlet boundary. The procedure eliminates boundary terms from the weak form.</li>
<li class="fragment">There are several good open source finite element solvers out there! (e.g., <a href="https://fenicsproject.org">FEniCS</a>, <a href="https://www.csc.fi/web/elmer">Elmer</a>, <a href="https://freefem.org">FreeFEM</a>)</li>
</ul>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>