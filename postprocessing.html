<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.33">

  <meta name="author" content="Prof.&nbsp;Mikael Mortensen, University of Oslo">
  <title>MATMEK-4270 presentations – Postprocessing and Interpolation</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-308b9879f03a02505d6580673c2f6257.css">
  <link rel="stylesheet" href="styles.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Postprocessing and Interpolation</h1>
  <p class="subtitle">MATMEK-4270</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Prof.&nbsp;Mikael Mortensen, University of Oslo 
</div>
</div>
</div>

</section>
<section id="postprocessing" class="slide level2 smaller">
<h2>Postprocessing</h2>
<p>We have computed the solution. Now what?</p>
<ul>
<li class="fragment">We analyze the solution!</li>
<li class="fragment">We process the solution into presentable tables and figures</li>
<li class="fragment">We extract important numbers that the solution allows us to compute. For example lift or drag on an airplane wing, or the flux through a boundary.</li>
</ul>
<div class="fragment">
<p>In order to achieve this we need</p>
<ul>
<li class="fragment"><strong>Interpolation</strong> - to get the solution everywhere and not just in nodes</li>
<li class="fragment"><strong>Integrals</strong> - Averages arise from integrals over domains and boundaries</li>
<li class="fragment"><strong>Derivatives</strong> - For example, drag is the integral of the gradient over a boundary <span class="math inline">\(\int_{\Gamma}\nu \nabla u \cdot \boldsymbol{n} d\Gamma\)</span>.</li>
<li class="fragment"><strong>Lagrange</strong> interpolation polynomials will help us get there!</li>
</ul>
</div>
</section>
<section id="one-dimensional-interpolation" class="slide level2 smaller">
<h2>One-dimensional interpolation</h2>
<p><span class="math display">\[
u(x) = x(1-x)
\]</span></p>
<div id="135b5229" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="postprocessing_files/figure-revealjs/cell-2-output-1.png" width="951" height="246"></p>
</figure>
</div>
</div>
</div>
<div class="fragment">
<p>We have the mesh function <span class="math inline">\((u(x_i))_{i=0}^{5}\)</span>. What is <span class="math inline">\(u(0.75)\)</span>?</p>
<p>Linear interpolation requires interpolating between <span class="math inline">\(u(x_3)\)</span> and <span class="math inline">\(u(x_4)\)</span></p>
<p><span class="math display">\[
\overline{u}(x) = u_3 + (u_4-u_3)\frac{x-x_3}{x_4-x_3}.
\]</span></p>
</div>
</section>
<section id="linear-interpolation-using-sympy" class="slide level2 smaller">
<h2>Linear interpolation using Sympy</h2>
<div id="98b6da75" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a>x <span class="op">=</span> sp.Symbol(<span class="st">'x'</span>)</span>
<span id="cb1-2"><a></a>uo <span class="op">=</span> u[<span class="dv">3</span>] <span class="op">+</span> (u[<span class="dv">4</span>]<span class="op">-</span>u[<span class="dv">3</span>])<span class="op">/</span>(xj[<span class="dv">4</span>]<span class="op">-</span>xj[<span class="dv">3</span>])<span class="op">*</span>(x<span class="op">-</span>xj[<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="08502634" class="cell" data-execution_count="3">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="postprocessing_files/figure-revealjs/cell-4-output-1.png" width="951" height="411"></p>
</figure>
</div>
</div>
</div>
<p>Linear interpolation is not very accurate. How do we increase accuracy?</p>
</section>
<section id="lagrange-interpolation" class="slide level2 smaller">
<h2>Lagrange interpolation</h2>
<p>Lagrange interpolation is a generic approach that uses any number of points from the mesh function and defines a <strong>Lagrange interpolation polynomial</strong></p>
<p><span class="math display">\[
L(x) = \sum_{j=0}^k u^j \ell_j(x)
\]</span></p>
<p>where <span class="math inline">\(\{u^j\}_{j=0}^k\)</span> are the mesh function values at the <strong>chosen</strong> <span class="math inline">\(k+1\)</span> mesh points. For the linear example we have just seen</p>
<p><span class="math display">\[
(u^0, u^1) = (u_3, u_4)
\]</span></p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Lagrange mesh function values are given a superscript that starts counting from 0.</p>
</div>
</div>
</div>
</section>
<section id="lagrange-basis-functions-and-nodes" class="slide level2 smaller">
<h2>Lagrange basis functions and nodes</h2>
<p>The Lagrange interpolation polynomial <span class="math display">\[
L(x) = \sum_{j=0}^k u^j \ell_j(x)
\]</span></p>
<p>contains <span class="math inline">\(k+1\)</span> <strong>basis functions</strong> <span class="math inline">\(\{\ell_j(x)\}_{j=0}^k\)</span>.</p>
<div class="fragment">
<p>The basis functions are defined using any number of chosen interpolation nodes <span class="math inline">\((x^0, \ldots, x^k)\)</span>. For our linear example the nodes are simply</p>
<p><span class="math display">\[
(x^0, x^1) = (x_3, x_4)
\]</span></p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Lagrange nodes are given a superscript that starts counting from 0. Choosing different nodes leads to different results!</p>
</div>
</div>
</div>
</div>
</section>
<section id="lagrange-basis-functions-are-defined-as" class="slide level2 smaller">
<h2>Lagrange basis functions are defined as</h2>
<p><span class="math display">\[
    \ell_j(x) = \frac{x-x^0}{x^j-x^0} \cdots \frac{x-x^{j-1}}{x^j-x^{j-1}}\frac{x-x^{j+1}}{x^j-x^{j+1}} \cdots \frac{x-x^{k}}{x^j-x^{k}}
\]</span></p>
<p>Let that one sink in.</p>
<div class="fragment">
<ul>
<li>Note index <span class="math inline">\(j\)</span> in <span class="math inline">\(\ell_j(x)\)</span>, the <span class="math inline">\(j\)</span>’th basis function.</li>
<li>Numerator contains the product of all differences <span class="math inline">\((x-x^m)\)</span> for all <span class="math inline">\(m\)</span> except <span class="math inline">\(m=j\)</span></li>
<li>Denominator contains the product of all differences <span class="math inline">\((x^j-x^m)\)</span> for all <span class="math inline">\(m\)</span> except <span class="math inline">\(m=j\)</span></li>
</ul>
</div>
<div class="fragment">
<p>We can write</p>
<p><span class="math display">\[
\ell_j(x) = \prod_{\substack{0 \le m \le k \\ m \ne j}} \frac{x-x^m}{x^j-x^m}.
\]</span></p>
</div>
</section>
<section id="lagrange-basis-in-sympy" class="slide level2 smaller">
<h2>Lagrange basis in Sympy</h2>
<p>A <strong>basis</strong> is a collection of basis functions</p>
<p><span class="math display">\[
\{\ell_j(x)\}_{j=0}^k
\]</span></p>
<div id="3563d97e" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a><span class="kw">def</span> Lagrangebasis(xj, x<span class="op">=</span>x):</span>
<span id="cb2-2"><a></a>  <span class="co">"""Construct Lagrange basis for points in xj</span></span>
<span id="cb2-3"><a></a></span>
<span id="cb2-4"><a></a><span class="co">  Parameters</span></span>
<span id="cb2-5"><a></a><span class="co">  ----------</span></span>
<span id="cb2-6"><a></a><span class="co">  xj : array</span></span>
<span id="cb2-7"><a></a><span class="co">    Interpolation points (nodes)</span></span>
<span id="cb2-8"><a></a><span class="co">  x : Sympy Symbol</span></span>
<span id="cb2-9"><a></a></span>
<span id="cb2-10"><a></a><span class="co">  Returns</span></span>
<span id="cb2-11"><a></a><span class="co">  -------</span></span>
<span id="cb2-12"><a></a><span class="co">  Lagrange basis as a list of Sympy functions </span></span>
<span id="cb2-13"><a></a><span class="co">  """</span></span>
<span id="cb2-14"><a></a>  <span class="im">from</span> sympy <span class="im">import</span> Mul</span>
<span id="cb2-15"><a></a>  n <span class="op">=</span> <span class="bu">len</span>(xj)</span>
<span id="cb2-16"><a></a>  ell <span class="op">=</span> []</span>
<span id="cb2-17"><a></a>  numert <span class="op">=</span> Mul(<span class="op">*</span>[x <span class="op">-</span> xj[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)])</span>
<span id="cb2-18"><a></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb2-19"><a></a>    numer <span class="op">=</span> numert<span class="op">/</span>(x <span class="op">-</span> xj[i])</span>
<span id="cb2-20"><a></a>    denom <span class="op">=</span> Mul(<span class="op">*</span>[(xj[i] <span class="op">-</span> xj[j]) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(n) <span class="cf">if</span> i <span class="op">!=</span> j])</span>
<span id="cb2-21"><a></a>    ell.append(numer<span class="op">/</span>denom)</span>
<span id="cb2-22"><a></a>  <span class="cf">return</span> ell </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-basis-for-linear-interpolation-of-our-first-example-is" class="slide level2 smaller">
<h2>The basis for linear interpolation of our first example is</h2>
<div id="e962c462" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a>ell <span class="op">=</span> Lagrangebasis(xj[<span class="dv">3</span>:<span class="dv">5</span>], x<span class="op">=</span>x)</span>
<span id="cb3-2"><a></a>ell</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>[4.0 - 5.0*x, 5.0*x - 3.0]</code></pre>
</div>
</div>
<p>We can plot these two linear functions between <span class="math inline">\(x_3\)</span> and <span class="math inline">\(x_4\)</span></p>
<div id="844fbf4e" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>))</span>
<span id="cb5-2"><a></a>plt.plot(xj, u, <span class="st">'bo'</span>)</span>
<span id="cb5-3"><a></a>xf <span class="op">=</span> np.linspace(xj[<span class="dv">3</span>], xj[<span class="dv">4</span>], <span class="dv">10</span>)</span>
<span id="cb5-4"><a></a>plt.plot(xf, sp.lambdify(x, ell[<span class="dv">0</span>])(xf), <span class="st">'g--'</span>)</span>
<span id="cb5-5"><a></a>plt.plot(xf, sp.lambdify(x, ell[<span class="dv">1</span>])(xf), <span class="st">'r--'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="postprocessing_files/figure-revealjs/cell-7-output-1.png" width="496" height="263"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lagrange-interpolation-polynomial" class="slide level2 smaller">
<h2>Lagrange interpolation polynomial</h2>
<p>With the basis we can now compute the Lagrange interpolation polynomial</p>
<p><span class="math display">\[
L(x) = \sum_{j=0}^k u^j \ell_j(x)
\]</span></p>
<div class="columns">
<div class="column">
<div id="7d65f90e" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a><span class="kw">def</span> Lagrangefunction(u, basis):</span>
<span id="cb6-2"><a></a>  <span class="co">"""Return Lagrange polynomial</span></span>
<span id="cb6-3"><a></a></span>
<span id="cb6-4"><a></a><span class="co">  Parameters</span></span>
<span id="cb6-5"><a></a><span class="co">  ----------</span></span>
<span id="cb6-6"><a></a><span class="co">  u : array</span></span>
<span id="cb6-7"><a></a><span class="co">    Mesh function values</span></span>
<span id="cb6-8"><a></a><span class="co">  basis : tuple of Lagrange basis functions</span></span>
<span id="cb6-9"><a></a><span class="co">    Output from Lagrangebasis</span></span>
<span id="cb6-10"><a></a><span class="co">  """</span></span>
<span id="cb6-11"><a></a>  f <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-12"><a></a>  <span class="cf">for</span> j, uj <span class="kw">in</span> <span class="bu">enumerate</span>(u):</span>
<span id="cb6-13"><a></a>    f <span class="op">+=</span> basis[j]<span class="op">*</span>uj</span>
<span id="cb6-14"><a></a>  <span class="cf">return</span> f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<div id="e606b6c3" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a>L <span class="op">=</span> Lagrangefunction(u[<span class="dv">3</span>:<span class="dv">5</span>], ell)</span>
<span id="cb7-2"><a></a>xf <span class="op">=</span> np.linspace(xj[<span class="dv">3</span>]<span class="op">-</span><span class="fl">0.1</span>, xj[<span class="dv">4</span>]<span class="op">+</span><span class="fl">0.1</span>, <span class="dv">10</span>)</span>
<span id="cb7-3"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>))</span>
<span id="cb7-4"><a></a>plt.plot(xj, u, <span class="st">'bo'</span>)</span>
<span id="cb7-5"><a></a>plt.plot(xf, sp.lambdify(x, L)(xf), <span class="st">'g'</span>) </span>
<span id="cb7-6"><a></a>plt.plot(<span class="fl">0.75</span>, L.subs(x, <span class="fl">0.75</span>), <span class="st">'ko'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="postprocessing_files/figure-revealjs/cell-9-output-1.png" width="505" height="263"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="we-can-choose-any-and-any-number-of-basis-functions" class="slide level2 smaller">
<h2>We can choose any, and any number of basis functions</h2>
<div class="columns">
<div class="column">
<h4 id="choose-x0-x1-x2-x_2-x_3-x_4">Choose <span class="math inline">\((x^0, x^1, x^2) = (x_2, x_3, x_4)\)</span></h4>
<div id="67040b84" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a></a>ell2 <span class="op">=</span> Lagrangebasis(xj[<span class="dv">2</span>:<span class="dv">5</span>], x<span class="op">=</span>x) </span>
<span id="cb8-2"><a></a>L <span class="op">=</span> Lagrangefunction(u[<span class="dv">2</span>:<span class="dv">5</span>], ell2)</span>
<span id="cb8-3"><a></a>xf <span class="op">=</span> np.linspace(xj[<span class="dv">2</span>], xj[<span class="dv">4</span>], <span class="dv">10</span>)</span>
<span id="cb8-4"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>))</span>
<span id="cb8-5"><a></a>plt.plot(xj, u, <span class="st">'bo'</span>)</span>
<span id="cb8-6"><a></a>plt.plot(xf, sp.lambdify(x, L)(xf), <span class="st">'g'</span>) </span>
<span id="cb8-7"><a></a>plt.plot(<span class="fl">0.75</span>, L.subs(x, <span class="fl">0.75</span>), <span class="st">'ko'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="postprocessing_files/figure-revealjs/cell-10-output-1.png" width="505" height="263"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<h4 id="choose-x0-x1-x2-x_3-x_4-x_5">Choose <span class="math inline">\((x^0, x^1, x^2) = (x_3, x_4, x_5)\)</span></h4>
<div id="7d5b241a" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a>ell3 <span class="op">=</span> Lagrangebasis(xj[<span class="dv">3</span>:<span class="dv">6</span>], x<span class="op">=</span>x) </span>
<span id="cb9-2"><a></a>L <span class="op">=</span> Lagrangefunction(u[<span class="dv">3</span>:<span class="dv">6</span>], ell3)</span>
<span id="cb9-3"><a></a>xf <span class="op">=</span> np.linspace(xj[<span class="dv">3</span>], xj[<span class="dv">5</span>], <span class="dv">10</span>)</span>
<span id="cb9-4"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>))</span>
<span id="cb9-5"><a></a>plt.plot(xj, u, <span class="st">'bo'</span>)</span>
<span id="cb9-6"><a></a>plt.plot(xf, sp.lambdify(x, L)(xf), <span class="st">'g'</span>) </span>
<span id="cb9-7"><a></a>plt.plot(<span class="fl">0.75</span>, L.subs(x, <span class="fl">0.75</span>), <span class="st">'ko'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="postprocessing_files/figure-revealjs/cell-11-output-1.png" width="505" height="267"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="with-three-nodes-the-lagrange-basis-functions-are-second-order-polynomials" class="slide level2 smaller">
<h2>With three nodes the Lagrange basis functions are second order polynomials</h2>
<div class="columns">
<div class="column">
<div id="0bb9c8b4" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>)) </span>
<span id="cb10-2"><a></a>ell2 <span class="op">=</span> Lagrangebasis(xj[<span class="dv">2</span>:<span class="dv">5</span>], x<span class="op">=</span>x) </span>
<span id="cb10-3"><a></a>plt.plot(xj, u, <span class="st">'bo-'</span>)</span>
<span id="cb10-4"><a></a>xl <span class="op">=</span> np.linspace(xj[<span class="dv">2</span>], xj[<span class="dv">4</span>], <span class="dv">100</span>)</span>
<span id="cb10-5"><a></a>plt.plot(xl, sp.lambdify(x, ell2[<span class="dv">0</span>])(xl), <span class="st">'r:'</span>)</span>
<span id="cb10-6"><a></a>plt.plot(xl, sp.lambdify(x, ell2[<span class="dv">1</span>])(xl), <span class="st">'g:'</span>)</span>
<span id="cb10-7"><a></a>plt.plot(xl, sp.lambdify(x, ell2[<span class="dv">2</span>])(xl), <span class="st">'b:'</span>)</span>
<span id="cb10-8"><a></a>plt.legend([<span class="vs">r'</span><span class="dv">$</span><span class="vs">u</span><span class="kw">(</span><span class="vs">x_i</span><span class="kw">)</span><span class="dv">$</span><span class="vs">'</span>, <span class="vs">r'</span><span class="dv">$</span><span class="er">\</span><span class="vs">ell_0</span><span class="kw">(</span><span class="vs">x</span><span class="kw">)</span><span class="dv">$</span><span class="vs">'</span>, <span class="vs">r'</span><span class="dv">$</span><span class="er">\</span><span class="vs">ell_1</span><span class="kw">(</span><span class="vs">x</span><span class="kw">)</span><span class="dv">$</span><span class="vs">'</span>, <span class="vs">r'</span><span class="dv">$</span><span class="er">\</span><span class="vs">ell_2</span><span class="kw">(</span><span class="vs">x</span><span class="kw">)</span><span class="dv">$</span><span class="vs">'</span>], loc<span class="op">=</span><span class="st">'upper left'</span>)<span class="op">;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="postprocessing_files/figure-revealjs/cell-12-output-1.png" width="496" height="337"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>All Lagrange basis functions are such that on the chosen mesh points <span class="math inline">\(\{x^{i}\}_{i=0}^{k}\)</span> we have</p>
<p><span class="math display">\[
\ell_j(x^i) = \delta_{ij} = \begin{cases} 1 \text{ for } i=j \\
0 \text{ for }  i\ne j
\end{cases}
\]</span></p>
</div>
</div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>The Lagrange basis functions do not depend on the mesh function values, only on the mesh points. The mesh points do not need to be uniform, any mesh will do as long as all points are different.</p>
</div>
</div>
</div>
</div></div>
</section>
<section id="interpolation-of-derivatives" class="slide level2 smaller">
<h2>Interpolation of derivatives</h2>
<p>The solution has been obtained in mesh points <span class="math inline">\(\boldsymbol{u}=(u(x_j))_{j=0}^N\)</span>. How can we compute <span class="math inline">\(u'(x)\)</span> for any given <span class="math inline">\(x\)</span>?</p>
<div class="fragment">
<p>Can we use the derivative matrix <span class="math inline">\(D^{(1)}\)</span> and thus</p>
<p><span class="math display">\[
\boldsymbol{f} = D^{(1)} \boldsymbol{u}
\]</span></p>
<p>such that the mesh function <span class="math inline">\(\boldsymbol{f}=(u'(x_j))_{j=0}^N\)</span>?</p>
</div>
<div class="fragment">
<p>Yes, but you then need to interpolate <span class="math inline">\(\boldsymbol{f}\)</span>!</p>
<p>Is there a better way?</p>
</div>
<div class="fragment">
<p>Yes! Just take the derivative of the Lagrange function</p>
<div class="columns">
<div class="column">
<p><span class="math display">\[
u' \approx L'(x) = \sum_{j=0}^k u^j \ell'_j(x)
\]</span></p>
</div><div class="column">
<div id="3d603888" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a>ell2 <span class="op">=</span> Lagrangebasis(xj[<span class="dv">2</span>:<span class="dv">5</span>], x<span class="op">=</span>x) </span>
<span id="cb11-2"><a></a>L <span class="op">=</span> Lagrangefunction(u[<span class="dv">2</span>:<span class="dv">5</span>], ell2) </span>
<span id="cb11-3"><a></a>f <span class="op">=</span> L.diff(x, <span class="dv">1</span>)</span>
<span id="cb11-4"><a></a>display(L)</span>
<span id="cb11-5"><a></a>display(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p><span class="math inline">\(\displaystyle 3.0 \left(x - 0.8\right) \left(x - 0.6\right) - 6.0 \left(x - 0.8\right) \left(x - 0.4\right) + 2.0 \left(x - 0.6\right) \left(x - 0.4\right)\)</span></p>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
<p><span class="math inline">\(\displaystyle 1.0 - 2.0 x\)</span></p>
</div>
</div>
</div></div>
</div>
</section>
<section id="if-the-problem-is-two-dimensional-then-we-have-the-solution-as-a-mesh-function" class="slide level2 smaller">
<h2>If the problem is two-dimensional, then we have the solution as a mesh function</h2>
<p><span class="math display">\[
u_{ij} = u(x_i, y_j), \quad i=0, 1, \ldots, N \, \text{and} \, j=0, 1, \ldots, N
\]</span></p>
<p>How do we use <span class="math inline">\(U = (u_{ij})_{i,j=0}^N\)</span> to compute <span class="math inline">\(u(x, y)\)</span> for any point <span class="math inline">\((x, y)\)</span> in the domain?</p>
<div class="fragment">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>2D interpolation</strong></p>
</div>
<div class="callout-content">
<p>We need to do interpolation in 2D!</p>
</div>
</div>
</div>
</div>
</section>
<section id="d-interpolation-1" class="slide level2 smaller">
<h2>2D-interpolation</h2>
<p>We consider first a simple function</p>
<p><span class="math display">\[
u(x, y) = x(1-x)y(1-y), \quad x, y \in \Omega = [0, 1]^2
\]</span></p>
<p>and we want to find <span class="math inline">\(u(0.55, 0.65)\)</span> from the mesh function <span class="math inline">\((u(x_i, y_j))_{i,j=0}^{10}\)</span>.</p>
<div id="8b150e0e" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a><span class="kw">def</span> mesh2D(Nx, Ny, Lx, Ly, sparse<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb12-2"><a></a>  x <span class="op">=</span> np.linspace(<span class="dv">0</span>, Lx, Nx<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb12-3"><a></a>  y <span class="op">=</span> np.linspace(<span class="dv">0</span>, Ly, Ny<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb12-4"><a></a>  <span class="cf">return</span> np.meshgrid(x, y, indexing<span class="op">=</span><span class="st">'ij'</span>, sparse<span class="op">=</span>sparse)</span>
<span id="cb12-5"><a></a></span>
<span id="cb12-6"><a></a>N <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb12-7"><a></a>xij, yij <span class="op">=</span> mesh2D(N, N, <span class="dv">1</span>, <span class="dv">1</span>, <span class="va">False</span>)</span>
<span id="cb12-8"><a></a>U <span class="op">=</span> xij<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>xij)<span class="op">*</span>yij<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>yij)</span>
<span id="cb12-9"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb12-10"><a></a>plt.contourf(xij, yij, U)</span>
<span id="cb12-11"><a></a>plt.plot(<span class="fl">0.55</span>, <span class="fl">0.65</span>, <span class="st">'ro'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="postprocessing_files/figure-revealjs/cell-14-output-1.png" class="quarto-figure quarto-figure-center" width="284" height="268"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="in-2d-we-need-to-choose-interpolation-points-in-2d-surrounding-the-point-of-interest" class="slide level2 smaller">
<h2>In 2D we need to choose interpolation points in 2D surrounding the point of interest</h2>
<div class="columns">
<div class="column">
<div id="abf66fe9" class="cell" data-execution_count="14">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="postprocessing_files/figure-revealjs/cell-15-output-1.png" class="quarto-figure quarto-figure-center" width="507" height="505"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div id="ed0e0d75" class="cell" data-execution_count="15">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="postprocessing_files/figure-revealjs/cell-16-output-1.png" class="quarto-figure quarto-figure-center" width="507" height="505"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="d-lagrange-interpolation-polynomials-makes-use-of-tensor-product-basis-functions" class="slide level2 smaller">
<h2>2D Lagrange interpolation polynomials makes use of tensor product basis functions</h2>
<p><span class="math display">\[
L(x, y) = \sum_{m=0}^k\sum_{n=0}^l u^{m,n} \ell_{m}(x) \ell_{n}(y),
\]</span></p>
<p>Here one (tensor product) basis function is</p>
<p><span class="math display">\[
\psi_{mn}(x, y) = \ell_{m}(x) \ell_{n}(y)
\]</span></p>
<p>and</p>
<p><span class="math display">\[
u^{m,n}  \quad m=0, \ldots, k \quad \text{and} \quad n=0, \ldots, l
\]</span></p>
<p>are the <span class="math inline">\((k+1)(l+1)\)</span> mesh points used for the interpolation.</p>
<ul>
<li>Two sets of mesh points: <span class="math inline">\((x^0, \ldots, x^k)\)</span> and <span class="math inline">\((y^0, \ldots, y^l)\)</span></li>
<li><span class="math inline">\(\{\ell_m(x)\}_{m=0}^k\)</span> and <span class="math inline">\(\{\ell_n(y)\}_{n=0}^l\)</span> are computed exactly as in 1D.</li>
</ul>
</section>
<section id="d-lagrange" class="slide level2 smaller">
<h2>2D Lagrange</h2>
<div id="ca1165b6" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a>xij, yij <span class="op">=</span> mesh2D(N, N, <span class="dv">1</span>, <span class="dv">1</span>, <span class="va">False</span>) </span>
<span id="cb13-2"><a></a>y <span class="op">=</span> sp.Symbol(<span class="st">'y'</span>)</span>
<span id="cb13-3"><a></a>lx <span class="op">=</span> Lagrangebasis(xij[<span class="dv">5</span>:<span class="dv">7</span>, <span class="dv">0</span>], x<span class="op">=</span>x)</span>
<span id="cb13-4"><a></a>ly <span class="op">=</span> Lagrangebasis(yij[<span class="dv">0</span>, <span class="dv">6</span>:<span class="dv">8</span>], x<span class="op">=</span>y)</span>
<span id="cb13-5"><a></a></span>
<span id="cb13-6"><a></a><span class="kw">def</span> Lagrangefunction2D(u, basisx, basisy):</span>
<span id="cb13-7"><a></a>  N, M <span class="op">=</span> u.shape</span>
<span id="cb13-8"><a></a>  f <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-9"><a></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb13-10"><a></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(M):</span>
<span id="cb13-11"><a></a>      f <span class="op">+=</span> basisx[i]<span class="op">*</span>basisy[j]<span class="op">*</span>u[i, j]</span>
<span id="cb13-12"><a></a>  <span class="cf">return</span> f</span>
<span id="cb13-13"><a></a></span>
<span id="cb13-14"><a></a>f <span class="op">=</span> Lagrangefunction2D(U[<span class="dv">5</span>:<span class="dv">7</span>, <span class="dv">6</span>:<span class="dv">8</span>], lx, ly)</span>
<span id="cb13-15"><a></a><span class="bu">print</span>(<span class="st">'The 2D Lagrange polynomial is:'</span>)</span>
<span id="cb13-16"><a></a>sp.nsimplify(sp.simplify(f), tolerance<span class="op">=</span><span class="fl">1e-8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The 2D Lagrange polynomial is:</code></pre>
</div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="16">
<p><span class="math inline">\(\displaystyle \frac{3 x y}{100} - \frac{21 x}{500} - \frac{9 y}{100} + \frac{63}{500}\)</span></p>
</div>
</div>
<p>Compare with exact. Not perfect since only linear interpolation.</p>
<div id="3bfb2e21" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a></a>ue <span class="op">=</span> x<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>x)<span class="op">*</span>y<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>y)</span>
<span id="cb15-2"><a></a><span class="bu">print</span>(<span class="st">'Numerical          Exact'</span>)</span>
<span id="cb15-3"><a></a><span class="bu">print</span>(f.subs({x: <span class="fl">0.55</span>, y: <span class="fl">0.65</span>}), ue.subs({x: <span class="fl">0.55</span>, y: <span class="fl">0.65</span>})) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Numerical          Exact
0.0551250000000000 0.0563062500000000</code></pre>
</div>
</div>
</section>
<section id="improve-accuracy-using-more-interpolation-points" class="slide level2 smaller">
<h2>Improve accuracy using more interpolation points</h2>
<div id="00df3b49" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a></a>lx <span class="op">=</span> Lagrangebasis(xij[<span class="dv">5</span>:<span class="dv">8</span>, <span class="dv">0</span>], x<span class="op">=</span>x)</span>
<span id="cb17-2"><a></a>ly <span class="op">=</span> Lagrangebasis(yij[<span class="dv">0</span>, <span class="dv">5</span>:<span class="dv">8</span>], x<span class="op">=</span>y)</span>
<span id="cb17-3"><a></a>L2 <span class="op">=</span> Lagrangefunction2D(U[<span class="dv">5</span>:<span class="dv">8</span>, <span class="dv">5</span>:<span class="dv">8</span>], lx, ly)</span>
<span id="cb17-4"><a></a><span class="bu">print</span>(<span class="st">'Numerical          Exact'</span>)</span>
<span id="cb17-5"><a></a><span class="bu">print</span>(L2.subs({x: <span class="fl">0.55</span>, y: <span class="fl">0.65</span>}), ue.subs({x: <span class="fl">0.55</span>, y: <span class="fl">0.65</span>})) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Numerical          Exact
0.0563062500000000 0.0563062500000000</code></pre>
</div>
</div>
</section>
<section id="in-2d-we-need-partial-derivatives" class="slide level2 smaller">
<h2>In 2D we need partial derivatives</h2>
<p>Using finite difference matrices is possible, but requires interpolation of outcome:</p>
<p><span class="math display">\[ \small
\left(\frac{\partial u}{\partial x}(x_i, y_j)\right)_{i,j=0}^{N} = D^{(1)} U \quad \text{and} \quad \left(\frac{\partial u}{\partial y}(x_i, y_j)\right)_{i,j=0}^{N} =  U (D^{(1)})^T.
\]</span></p>
<div class="fragment">
<p>As in 1D take the derivatives of the Lagrange polynomials:</p>
<p><span class="math display">\[ \small
\frac{\partial u}{\partial x} = \frac{\partial L(x, y)}{\partial x} = \sum_{m=0}^k\sum_{n=0}^l u^{m,n} \frac{\partial \ell_{m}(x)}{\partial x} \ell_{n}(y)
\]</span> <span class="math display">\[ \small
\frac{\partial u}{\partial y} = \frac{\partial L(x, y)}{\partial y} = \sum_{m=0}^k\sum_{n=0}^l u^{m,n} \ell_{m}(x) \frac{\partial \ell_{n}(y)}{\partial y}
\]</span></p>
<p>Verification:</p>
<div id="12736dcf" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a></a>dLx <span class="op">=</span> sp.diff(L2, x)</span>
<span id="cb19-2"><a></a>dLy <span class="op">=</span> sp.diff(L2, y)</span>
<span id="cb19-3"><a></a><span class="bu">print</span>(<span class="st">'Numerical          Exact'</span>)</span>
<span id="cb19-4"><a></a><span class="bu">print</span>(dLx.subs({x: <span class="fl">0.55</span>, y: <span class="fl">0.65</span>}), sp.diff(ue, x).subs({x: <span class="fl">0.55</span>, y: <span class="fl">0.65</span>})) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Numerical          Exact
-0.0227500000000000 -0.0227500000000000</code></pre>
</div>
</div>
</div>
</section>
<section id="other-tools-for-interpolation-are-available" class="slide level2 smaller">
<h2>Other tools for interpolation are available</h2>
<h4 id="scipy.interpolate">Scipy.interpolate</h4>
<div id="5c501beb" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a></a><span class="im">from</span> scipy.interpolate <span class="im">import</span> interpn</span>
<span id="cb21-2"><a></a><span class="bu">print</span>(<span class="st">'Numerical          Exact'</span>)</span>
<span id="cb21-3"><a></a><span class="bu">print</span>(interpn((xij[<span class="dv">5</span>:<span class="dv">8</span>, <span class="dv">0</span>], yij[<span class="dv">0</span>, <span class="dv">5</span>:<span class="dv">8</span>]), U[<span class="dv">5</span>:<span class="dv">8</span>, <span class="dv">5</span>:<span class="dv">8</span>], np.array([<span class="fl">0.55</span>, <span class="fl">0.65</span>])), ue.subs({x: <span class="fl">0.55</span>, y: <span class="fl">0.65</span>}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Numerical          Exact
[0.055125] 0.0563062500000000</code></pre>
</div>
</div>
<p>Defaults to linear interpolation, so not very accurate.</p>
<div class="fragment">
<p>Easy to use more points and cubic interpolation:</p>
<div id="7b6adffa" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a></a><span class="bu">print</span>(<span class="st">'Numerical          Exact'</span>) </span>
<span id="cb23-2"><a></a><span class="bu">print</span>(interpn((xij[<span class="dv">5</span>:<span class="dv">9</span>, <span class="dv">0</span>], yij[<span class="dv">0</span>, <span class="dv">5</span>:<span class="dv">9</span>]), U[<span class="dv">5</span>:<span class="dv">9</span>, <span class="dv">5</span>:<span class="dv">9</span>], np.array([<span class="fl">0.55</span>, <span class="fl">0.65</span>]), method<span class="op">=</span><span class="st">'cubic'</span>), ue.subs({x: <span class="fl">0.55</span>, y: <span class="fl">0.65</span>})) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Numerical          Exact
[0.05630625] 0.0563062500000000</code></pre>
</div>
</div>
</div>
</section>
<section id="how-to-compute-errors-in-2d" class="slide level2 smaller">
<h2>How to compute errors in 2D</h2>
<p>For the numerical solution <span class="math inline">\(u\)</span> and the exact solution <span class="math inline">\(u^{e}\)</span> the <span class="math inline">\(L^2\)</span> error norm can in general, for any domain <span class="math inline">\(\Omega\)</span> and number of dimensions, be defined as</p>
<p><span class="math display">\[
\|u-u^{e}\|_{L^2(\Omega)} = \sqrt{\int_{\Omega} (u-u^{e})^2 d\Omega}.
\]</span></p>
<p>In 2D <span class="math inline">\(\Omega = [0, L_x] \times [0, L_y]\)</span> and the integral becomes</p>
<p><span class="math display">\[
\|u-u^{e}\|_{L^2(\Omega)} = \sqrt{\int_{0}^{L_x}\int_0^{L_y}(u-u^{e})^2 dy dx}.
\]</span></p>
<div class="fragment">
<p>Numerical integration can be performed using, e.g., the midpoint rule</p>
<p><span class="math display">\[
I(u)  = \sum_{i=0}^{N_x-1} \sum_{j=0}^{N_y-1} u((i+0.5)\Delta x, (j+0.5) \Delta y) \Delta x \Delta y \approx \int_{0}^{L_x}\int_0^{L_y}u(x,y) dy dx.
\]</span></p>
</div>
</section>
<section id="midpoint-integration" class="slide level2 smaller">
<h2>Midpoint integration</h2>
<div id="0cde71fe" class="cell" data-execution_count="22">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="postprocessing_files/figure-revealjs/cell-23-output-1.png" class="quarto-figure quarto-figure-center" width="391" height="389"></p>
</figure>
</div>
</div>
</div>
<p>All values <span class="math inline">\(u(x, y)\)</span> are required in the center of computational cells and not in nodes.</p>
<p><span class="math display">\[
\| u-u^{e} \|_{L^2} = \sqrt{I((u - u^{e})^2)}
\]</span></p>
</section>
<section id="numerical-midpoint-integration-tested" class="slide level2 smaller">
<h2>Numerical midpoint integration tested</h2>
<div id="be3e278d" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a></a>N <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb25-2"><a></a>xij, yij <span class="op">=</span> mesh2D(N, N, <span class="dv">1</span>, <span class="dv">1</span>, <span class="va">False</span>)</span>
<span id="cb25-3"><a></a>U <span class="op">=</span> np.cos(xij)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>xij)<span class="op">*</span>np.sin(yij)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>yij)</span>
<span id="cb25-4"><a></a>ue <span class="op">=</span> sp.cos(x)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>x)<span class="op">*</span>sp.sin(y)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>y)</span>
<span id="cb25-5"><a></a></span>
<span id="cb25-6"><a></a><span class="kw">def</span> I(u, dx, dy):</span>
<span id="cb25-7"><a></a>  um <span class="op">=</span> (u[:<span class="op">-</span><span class="dv">1</span>, :<span class="op">-</span><span class="dv">1</span>]<span class="op">+</span>u[<span class="dv">1</span>:, :<span class="op">-</span><span class="dv">1</span>]<span class="op">+</span>u[:<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>:]<span class="op">+</span>u[<span class="dv">1</span>:, <span class="dv">1</span>:])<span class="op">/</span><span class="dv">4</span></span>
<span id="cb25-8"><a></a>  <span class="cf">return</span> np.sqrt(np.<span class="bu">sum</span>(um<span class="op">*</span>dx<span class="op">*</span>dy))</span>
<span id="cb25-9"><a></a></span>
<span id="cb25-10"><a></a>I(U, <span class="dv">1</span><span class="op">/</span>N, <span class="dv">1</span><span class="op">/</span>N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>np.float64(0.2696557024695919)</code></pre>
</div>
</div>
<p>Compared to the exact integral</p>
<div id="4b20d1eb" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a></a><span class="bu">float</span>(sp.sqrt(sp.integrate(sp.integrate(ue, (y, <span class="dv">0</span>, <span class="dv">1</span>)), (x, <span class="dv">0</span>, <span class="dv">1</span>))).n())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>0.26995448271292816</code></pre>
</div>
</div>
<div class="fragment">
<p>The error norm <span class="math inline">\(\|u-u^{e}\|_{L^2} = \sqrt{I((u-u^{e})^2)}\)</span> is</p>
<div id="ee8856e5" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a></a>np.sqrt(I((U<span class="op">-</span>sp.lambdify((x, y), ue)(xij, yij))<span class="op">**</span><span class="dv">2</span>, <span class="dv">1</span><span class="op">/</span>N, <span class="dv">1</span><span class="op">/</span>N))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>np.float64(3.1759481967064892e-09)</code></pre>
</div>
</div>
<p>which is very small because the Lagrange interpolator happens to be close to exact exact for all the midpoints for this function. It is not zero in general.</p>
</div>
</section>
<section id="numerical-integration-can-also-for-example-use-the-trapezoidal-or-simpson-methods" class="slide level2 smaller">
<h2>Numerical integration can also, for example, use the trapezoidal or Simpson methods</h2>
<p>Trapezoidal:</p>
<div id="881eb056" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a></a><span class="kw">def</span> I_trapz(u, dx, dy):</span>
<span id="cb31-2"><a></a>  <span class="cf">return</span> np.sqrt(np.trapz(np.trapz(u<span class="op">**</span><span class="dv">2</span>, dx<span class="op">=</span>dy, axis<span class="op">=</span><span class="dv">1</span>), dx<span class="op">=</span>dx))</span>
<span id="cb31-3"><a></a>I_trapz(U, <span class="dv">1</span><span class="op">/</span>N, <span class="dv">1</span><span class="op">/</span>N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>np.float64(0.09592899344305951)</code></pre>
</div>
</div>
<p>Simpson’s rule:</p>
<div id="608393e1" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a></a><span class="kw">def</span> I_simps(u, dx, dy):</span>
<span id="cb33-2"><a></a>  <span class="im">from</span> scipy.integrate <span class="im">import</span> simpson <span class="im">as</span> simp</span>
<span id="cb33-3"><a></a>  <span class="cf">return</span> np.sqrt(simp(simp(u<span class="op">**</span><span class="dv">2</span>, dx<span class="op">=</span>dy, axis<span class="op">=</span><span class="dv">1</span>), dx<span class="op">=</span>dx))</span>
<span id="cb33-4"><a></a>I_simps(U, <span class="dv">1</span><span class="op">/</span>N, <span class="dv">1</span><span class="op">/</span>N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>np.float64(0.09586418448463656)</code></pre>
</div>
</div>
<p>Exact:</p>
<div id="f9098231" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a></a><span class="bu">float</span>(sp.sqrt(sp.integrate(sp.integrate(ue<span class="op">**</span><span class="dv">2</span>, (y, <span class="dv">0</span>, <span class="dv">1</span>)), (x, <span class="dv">0</span>, <span class="dv">1</span>))).n())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>0.09586332023451888</code></pre>
</div>
</div>
</section>
<section id="just-like-for-the-1d-case-there-is-a-simplification-for-l2-using-the-small-ell2-norm-instead" class="slide level2 smaller">
<h2>Just like for the 1D case there is a simplification for <span class="math inline">\(L^2\)</span> using the small <span class="math inline">\(\ell^2\)</span> norm instead</h2>
<p><span class="math display">\[
\|(u-u_e)\|_{\ell^2} = \sqrt{ \Delta x \Delta y \sum_{i=0}^{N_x}\sum_{j=0}^{N_y} (u_{ij}-u^{e}_{ij})^2 }.
\]</span></p>
<p>This is an approximation of the numerical integration using the trapezoidal method</p>
<p>Implementation:</p>
<div id="0c0fbec0" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a></a><span class="kw">def</span> l2_error(u, dx, dy):</span>
<span id="cb37-2"><a></a>  <span class="cf">return</span> np.sqrt(dx<span class="op">*</span>dy<span class="op">*</span>np.<span class="bu">sum</span>(u<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb37-3"><a></a>l2_error(U<span class="op">-</span>sp.lambdify((x, y), ue)(xij, yij), <span class="dv">1</span><span class="op">/</span>N, <span class="dv">1</span><span class="op">/</span>N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>np.float64(1.00866469481632e-17)</code></pre>
</div>
</div>
</section>
<section id="integration-over-boundary" class="slide level2 smaller">
<h2>Integration over boundary</h2>
<p>In many real problems we are not interested in the solution at a point, but rather in average values, or values integrated over a boundary.</p>

<img data-src="./figures/plane-wing-shape-design-lift-600nw-2155331617.webp" class="r-stretch"></section>
<section id="our-computational-domain-is-simpler-and-boundary-integrals-are-simpler-as-well" class="slide level2 smaller">
<h2>Our computational domain is simpler and boundary integrals are simpler as well</h2>
<div class="columns">
<div class="column">
<div id="8d401c02" class="cell" data-execution_count="30">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="postprocessing_files/figure-revealjs/cell-31-output-1.png" width="470" height="465"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<p>Integrate over boundary at <span class="math inline">\(x=L_x\)</span></p>
<p><span class="math display">\[
\int_{0}^{L_y} u(x=L_x, y) dy
\]</span></p>
<div id="3df691fc" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a></a>np.trapz(U[<span class="op">-</span><span class="dv">1</span>], dx<span class="op">=</span><span class="dv">1</span><span class="op">/</span>N, axis<span class="op">=</span><span class="dv">0</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>np.float64(0.0)</code></pre>
</div>
</div>
<p>Integrate over boundary at <span class="math inline">\(y=L_y\)</span></p>
<p><span class="math display">\[
\int_{0}^{L_x} u(x, y=L_y) dx
\]</span></p>
<div id="29a547f1" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a></a>np.trapz(U[:, <span class="op">-</span><span class="dv">1</span>], dx<span class="op">=</span><span class="dv">1</span><span class="op">/</span>N, axis<span class="op">=</span><span class="dv">0</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>np.float64(0.0)</code></pre>
</div>
</div>
</div></div>
</section>
<section id="friction-requires-derivatives" class="slide level2 smaller">
<h2>Friction requires derivatives</h2>
<div class="columns">
<div class="column">
<div id="91641c22" class="cell" data-execution_count="33">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="postprocessing_files/figure-revealjs/cell-34-output-1.png" width="398" height="392"></p>
</figure>
</div>
</div>
</div>
<p>Gradient in normal direction</p>
<p><span class="math display">\[
\int_{\Gamma} \nabla u \cdot \boldsymbol{n} d\Gamma
\]</span></p>
</div><div class="column">
<p>Integrate gradient at <span class="math inline">\(y=0\)</span></p>
<p><span class="math display">\[
\int_{0}^{L_x} \frac{\partial u}{\partial y}(x, y=0) dx
\]</span></p>
<div id="eccae163" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a></a>dudy <span class="op">=</span> (N<span class="op">/</span><span class="dv">2</span>)<span class="op">*</span>(<span class="op">-</span><span class="dv">3</span><span class="op">*</span>U[:, <span class="dv">0</span>] <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>U[:, <span class="dv">1</span>] <span class="op">-</span> U[:, <span class="dv">2</span>])</span>
<span id="cb43-2"><a></a>np.trapz(dudy, dx<span class="op">=</span><span class="dv">1</span><span class="op">/</span>N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>np.float64(0.4601188642377852)</code></pre>
</div>
</div>
<div id="404f37fc" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a></a>dudye <span class="op">=</span> sp.diff(ue, y)</span>
<span id="cb45-2"><a></a><span class="bu">float</span>(sp.integrate(dudye.subs(y, <span class="dv">0</span>), (x, <span class="dv">0</span>, <span class="dv">1</span>)).n())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>0.4596976941318603</code></pre>
</div>
</div>
<p>Integrate over boundary at <span class="math inline">\(x=L_x\)</span></p>
<p><span class="math display">\[
\int_{0}^{L_y} \frac{\partial u}{\partial x}(x=L_x, y) dy
\]</span></p>
<div id="9e102620" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a></a>dudx <span class="op">=</span> (N<span class="op">/</span><span class="dv">2</span>)<span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>U[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> <span class="dv">4</span><span class="op">*</span>U[<span class="op">-</span><span class="dv">2</span>] <span class="op">+</span> U[<span class="op">-</span><span class="dv">3</span>])</span>
<span id="cb47-2"><a></a>np.trapz(dudx, dx<span class="op">=</span><span class="dv">1</span><span class="op">/</span>N) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>np.float64(-0.08567622273572727)</code></pre>
</div>
</div>
</div></div>
</section>
<section>
<section id="two-dimensional-wave-equation" class="title-slide slide level1 smaller center">
<h1>Two-dimensional wave equation</h1>

<img data-src="./figures/wavemovie2d.apng" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="two-dimensional-wave-equation-1" class="slide level2 smaller">
<h2>Two-dimensional wave equation</h2>
<p><span class="math display">\[
\frac{\partial^2 u}{\partial t^2} = c^2 \nabla^2 u, \quad \Omega = (0, L_x) \times (0, L_y), t \in (0, T]
\]</span></p>
<p>We use an initial condition <span class="math inline">\(u(x, y, 0) = I(x, y)\)</span> and <span class="math inline">\(\frac{\partial u}{\partial t}(x, y, 0)=0\)</span> and homogeneous Dirichlet boundary conditions <span class="math inline">\(u(x, y, t)=0\)</span> for the entire boundary.</p>
<div class="fragment">
<p>For 2D waves we have frequencies in two directions</p>
<p><span class="math display">\[
\boldsymbol{k} = k_x \boldsymbol{i} + k_y \boldsymbol{j}
\]</span></p>
</div>
<div class="fragment">
<p>Any solution to the wave equation can be written as combinations of waves</p>
<p><span class="math display">\[
u(x, y, t) = g(k_x x + k_y y - |\boldsymbol{k}|ct)
\]</span></p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Try to validate by inserting for <span class="math inline">\(u(x, y, t)= g(k_x x + k_y y - |\boldsymbol{k}|ct)\)</span> into the wave equation. Use for example a variable <span class="math inline">\(\alpha = k_x x + k_y y - |\boldsymbol{k}|ct\)</span> and the chain rule, such that <span class="math inline">\(\frac{\partial g}{\partial t} = \frac{\partial g}{\partial \alpha} \frac{\partial \alpha}{\partial t}\)</span> etc.</p>
</div>
</div>
</div>
</div>
</section>
<section id="discretization-of-the-wave-equation-in-2d" class="slide level2 smaller">
<h2>Discretization of the wave equation in 2D</h2>
<p>For all internal points we have the second order accurate <span class="math display">\[
\frac{u^{n+1}_{i,j} - 2u^n_{i,j} + u^{n-1}_{i, j}}{\Delta t^2} =
c^2 \left(\frac{u^n_{i+1,j} - 2u^n_{i,j} + u^n_{i-1, j}}{\Delta x^2} + \frac{u^n_{i,j+1} - 2u^n_{i,j} + u^n_{i, j-1}}{\Delta y^2}\right)
\]</span></p>
<div class="fragment">
<p>or on vectorized form using <span class="math inline">\(U^n = \Big( u(x_i, y_j, n \Delta t)\Big)_{i,j=0}^{N, N}\)</span> and <span class="math inline">\(D_x^{(2)}\)</span> and <span class="math inline">\(D_y^{(2)}\)</span> as second derivative matrices for <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> directions, respectively</p>
<p><span class="math display">\[
\frac{U^{n+1}-2U^n+U^{n-1}}{\Delta t^2} = c^2 \left( D^{(2)}_x U^n + U^n (D^{(2)}_y)^T \right).
\]</span></p>
</div>
</section>
<section id="how-to-specify-initial-conditions" class="slide level2 smaller">
<h2>How to specify initial conditions</h2>
<p>The initial condition <span class="math inline">\(\frac{\partial u}{\partial t}(x, y, 0) = 0\)</span> can be implemented like we did in lecture 5 for the wave equation with one spatial dimension. We use a ghost node:</p>
<p><span class="math display">\[
\frac{\partial u}{\partial t}(x, y, t=0) = 0 = \frac{U^1-U^{-1}}{2 \Delta t} \rightarrow U^1 = U^{-1},
\]</span></p>
<p>And we use the PDE for <span class="math inline">\(n=0\)</span></p>
<p><span class="math display">\[
\frac{U^{1}-2U^0+U^{-1}}{\Delta t^2} = c^2 \left( D^{(2)}_x U^0 + U^0 (D^{(2)}_y)^T \right),
\]</span></p>
<p>such that</p>
<p><span class="math display">\[
U^1 = U^0 + \frac{c^2 \Delta t^2}{2} \left( D^{(2)}_x U^0 + U^0 (D^{(2)}_y)^T \right).
\]</span></p>
</section>
<section id="ths-solution-algorithm-for-the-2d-wave-equation" class="slide level2 smaller">
<h2>Ths solution algorithm for the 2D wave equation</h2>
<ol type="1">
<li>Specify <span class="math inline">\(U^0\)</span> and <span class="math inline">\(U^1\)</span> from initial conditions</li>
<li>for n in (1, 2, …, <span class="math inline">\(N_t-1\)</span>) compute
<ul>
<li><span class="math inline">\(U^{n+1} = 2U^n - U^{n-1} + (c\Delta t)^2 \left( D^{(2)}_x U^n + U^n (D^{(2)}_y)^T \right)\)</span></li>
<li>Apply boundary conditions to <span class="math inline">\(U^{n+1}\)</span></li>
<li>Swap <span class="math inline">\(U^{n-1} \leftarrow U^n\)</span> and <span class="math inline">\(U^n \leftarrow U^{n+1}\)</span> if using only three solution vectors</li>
</ul></li>
</ol>
</section>
<section id="stability-considerations-make-use-of-fourier-exponentials-as-solutions-in-a-periodic-domain" class="slide level2 smaller">
<h2>Stability considerations make use of Fourier exponentials as solutions in a periodic domain</h2>
<p><span class="math display">\[
u(x, y, t) = e^{\hat{\imath} (\boldsymbol{k} \cdot \boldsymbol{x} + \omega t)}
\]</span></p>
<p>where <span class="math inline">\(\omega = |\boldsymbol{k}| c\)</span> and <span class="math inline">\(\hat{\imath}=\sqrt{-1}\)</span>.</p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p><span class="math inline">\(\boldsymbol{x} = x \boldsymbol{i} + y \boldsymbol{j}\)</span> and <span class="math inline">\(\boldsymbol{k} = k_x \boldsymbol{i} + k_y \boldsymbol{j}\)</span>, such that <span class="math inline">\(\boldsymbol{k} \cdot \boldsymbol{x} = k_x x + k_y y\)</span>.</p>
</div>
</div>
</div>
<div class="fragment">
<p>A mesh solution is then</p>
<p><span class="math display">\[
\begin{align}
u^n_{ij} &amp;= u(x_i, y_j, t_n) = e^{\hat{\imath} (i k_x \Delta x + j k_y \Delta y + \omega n \Delta t)} \\
&amp;=(e^{\hat{\imath} \omega \Delta t})^n e^{\hat{\imath} (i k_x \Delta x + j k_y \Delta y)} \\
&amp;= A^n E(i, j)
\end{align}
\]</span></p>
<p>with amplification factor <span class="math inline">\(A=e^{\hat{\imath} \omega \Delta t}\)</span> and <span class="math inline">\(E(i, j) = e^{\hat{\imath} (i k_x \Delta x + j k_y \Delta y)}\)</span>.</p>
</div>
</section>
<section id="stability-of-discretization" class="slide level2 smaller">
<h2>Stability of discretization</h2>
<p>We have</p>
<p><span class="math display">\[
\frac{u^{n+1}_{i,j} - 2u^n_{i,j} + u^{n-1}_{i, j}}{\Delta t^2} =
c^2 \left(\frac{u^n_{i+1,j} - 2u^n_{i,j} + u^n_{i-1, j}}{\Delta x^2} + \frac{u^n_{i,j+1} - 2u^n_{i,j} + u^n_{i, j-1}}{\Delta y^2}\right)
\]</span></p>
<div class="fragment">
<p>To calculate the stability of this scheme we need to insert for <span class="math inline">\(u^n_{ij} = A^n E(i, j)\)</span> and compute the amplification factor <span class="math inline">\(A\)</span>. For stability we require</p>
<p><span class="math display">\[
|A| \le 1
\]</span></p>
<p>This is the same stability criterion as used in the 1D case.</p>
</div>
</section>
<section id="insert-for-small-un_ij-an-ei-j-in-the-discretized-wave-equation" class="slide level2 smaller">
<h2>Insert for <span class="math inline">\(\small u^n_{ij} = A^n E(i, j)\)</span> in the discretized wave equation</h2>
<p><span class="math display">\[ \small
\begin{equation}
\begin{split}
\frac{(A^{n+1} - 2A^n + A^{n-1})E(i, j)}{\Delta t^2} &amp;=
c^2 A^n \Big\{ \\
    &amp; \frac{ E(i+1, j) - 2E(i, j) +  E(i-1, j)}{\Delta x^2} \\
+ &amp; \frac{E(i, j+1) - 2E(i, j) + E(i, j-1)}{\Delta y^2} \Big\}
\end{split}
\end{equation}
\]</span></p>
<p>Divide by <span class="math inline">\(A^n E(i, j)\)</span> and multiply by <span class="math inline">\(\Delta t^2\)</span> in order to find <span class="math inline">\(A\)</span>. We also use that, e.g.,</p>
<p><span class="math display">\[ \small
\frac{E(i+1, j)}{E(i, j)} = \frac{e^{\hat{\imath}((i+1)k_x \Delta x + j k_y \Delta y)}}{e^{\hat{\imath}(i k_x \Delta x + j k_y \Delta y)}} = e^{\hat{\imath} k_x \Delta x}
\]</span></p>
<p><span class="math display">\[ \small
\frac{E(i, j-1)}{E(i, j)} = \frac{e^{\hat{\imath}(ik_x \Delta x + (j-1) k_y \Delta y)}}{e^{\hat{\imath}(i k_x \Delta x + j k_y \Delta y)}} = e^{- \hat{\imath} k_y \Delta y}
\]</span></p>
</section>
<section id="after-some-manipulations-we-get" class="slide level2 smaller">
<h2>After some manipulations we get</h2>
<p><span class="math display">\[
A - 2 + A^{-1} =
c^2 \Delta t^2 \left( \frac{ e^{\hat{\imath} k_x \Delta x} - 2 + e^{- \hat{\imath} k_x \Delta x} }{\Delta x^2} + \frac{ e^{\hat{\imath} k_y \Delta y} - 2 + e^{- \hat{\imath} k_y \Delta y} }{\Delta y^2} \right)
\]</span></p>
<p>which can be written as</p>
<p><span class="math display">\[
A + A^{-1} = \beta
\]</span></p>
<p>with</p>
<p><span class="math display">\[
\beta =  2 + 2 c^2 \Delta t^2 \left(\frac{\cos (k_x \Delta x) - 1}{\Delta x^2} + \frac{\cos (k_y \Delta y) - 1}{\Delta y^2} \right)
\]</span></p>
<p>where we have used <span class="math inline">\(e^{\hat{\imath} x} + e^{-\hat{\imath} x} = 2\cos x\)</span>.</p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>The derivation is more or less exactly as for the wave equation in 1D.</p>
</div>
</div>
</div>
</section>
<section id="from-lecture-5-we-remember-that" class="slide level2 smaller">
<h2>From lecture 5 we remember that</h2>
<p><span class="math display">\[
A + A^{-1} = \beta
\]</span></p>
<p>implies that <span class="math inline">\(|A|=1\)</span> when</p>
<p><span class="math display">\[
-2 \le \beta \le 2
\]</span></p>
<p>Hence, for stability we need</p>
<p><span class="math display">\[
-2 \le 2 + 2 c^2 \Delta t^2 \left(\frac{\cos (k_x \Delta x) - 1}{\Delta x^2} + \frac{\cos (k_y \Delta y) - 1}{\Delta y^2} \right) \le 2
\]</span></p>
<p>or</p>
<p><span class="math display">\[
-2 \le c^2 \Delta t^2 \left(\frac{\cos (k_x \Delta x) - 1}{\Delta x^2} + \frac{\cos (k_y \Delta y) - 1}{\Delta y^2} \right) \le 0
\]</span></p>
</section>
<section id="stability-limit-on-time-step" class="slide level2 smaller">
<h2>Stability limit on time step</h2>
<p>Since <span class="math inline">\(\cos (k_x \Delta x)\)</span> and <span class="math inline">\(\cos (k_y \Delta y)\)</span> are at worst <span class="math inline">\(-1\)</span> each, we get from <span class="math display">\[ \small
-2 \le c^2 \Delta t^2 \left(\frac{\cos (k_x \Delta x) - 1}{\Delta x^2} + \frac{\cos (k_y \Delta y) - 1}{\Delta y^2} \right) \le 0
\]</span></p>
<p>that</p>
<p><span class="math display">\[ \small
-2 \le c^2 \Delta t^2 \left( \frac{-2}{\Delta x^2} + \frac{-2}{\Delta y^2} \right)
\]</span></p>
<p>which is simplified further into</p>
<p><span class="math display">\[ \small
\left(\frac{c \Delta t}{\Delta x} \right)^2 + \left(\frac{c \Delta t}{\Delta y} \right)^2 \le 1
\]</span></p>
<p>This is the stability limit on <span class="math inline">\(\Delta t\)</span> for the 2D wave equation. If <span class="math inline">\(\Delta x = \Delta y = h\)</span>, then</p>
<p><span class="math display">\[ \small
\frac{c \Delta t}{h} \le \frac{1}{\sqrt{2}}
\]</span></p>
</section>
<section id="implementation" class="slide level2 smaller">
<h2>Implementation</h2>
<div class="sourceCode" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a></a><span class="kw">def</span> D2(N):</span>
<span id="cb49-2"><a></a>  D <span class="op">=</span> sparse.diags([<span class="dv">1</span>, <span class="op">-</span><span class="dv">2</span>, <span class="dv">1</span>], [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>], (N<span class="op">+</span><span class="dv">1</span>, N<span class="op">+</span><span class="dv">1</span>), <span class="st">'lil'</span>)</span>
<span id="cb49-3"><a></a>  D[<span class="dv">0</span>, :<span class="dv">4</span>] <span class="op">=</span> <span class="dv">2</span>, <span class="op">-</span><span class="dv">5</span>, <span class="dv">4</span>, <span class="op">-</span><span class="dv">1</span></span>
<span id="cb49-4"><a></a>  D[<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">4</span>:] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>, <span class="op">-</span><span class="dv">5</span>, <span class="dv">2</span></span>
<span id="cb49-5"><a></a>  <span class="cf">return</span> D</span>
<span id="cb49-6"><a></a></span>
<span id="cb49-7"><a></a><span class="kw">def</span> solver(N, L, Nt, cfl<span class="op">=</span><span class="fl">0.5</span>, c<span class="op">=</span><span class="dv">1</span>, store_data<span class="op">=</span><span class="dv">10</span>, u0<span class="op">=</span><span class="kw">lambda</span> x, y: np.exp(<span class="op">-</span><span class="dv">40</span><span class="op">*</span>((x<span class="op">-</span><span class="fl">0.6</span>)<span class="op">**</span><span class="dv">2</span><span class="op">+</span>(y<span class="op">-</span><span class="fl">0.5</span>)<span class="op">**</span><span class="dv">2</span>))):</span>
<span id="cb49-8"><a></a>  xij, yij <span class="op">=</span> mesh2D(N, N, L, L)</span>
<span id="cb49-9"><a></a>  Unp1, Un, Unm1 <span class="op">=</span> np.zeros((<span class="dv">3</span>, N<span class="op">+</span><span class="dv">1</span>, N<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb49-10"><a></a>  Unm1[:] <span class="op">=</span> u0(xij, yij)</span>
<span id="cb49-11"><a></a>  dx <span class="op">=</span> L <span class="op">/</span> N</span>
<span id="cb49-12"><a></a>  D <span class="op">=</span> D2(N)<span class="op">/</span>dx<span class="op">**</span><span class="dv">2</span></span>
<span id="cb49-13"><a></a>  dt <span class="op">=</span> cfl<span class="op">*</span>dx<span class="op">/</span>c</span>
<span id="cb49-14"><a></a>  Un[:] <span class="op">=</span> Unm1[:] <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span>(c<span class="op">*</span>dt)<span class="op">**</span><span class="dv">2</span><span class="op">*</span>(D <span class="op">@</span> Un <span class="op">+</span> Un <span class="op">@</span> D.T)</span>
<span id="cb49-15"><a></a>  plotdata <span class="op">=</span> {<span class="dv">0</span>: Unm1.copy()}</span>
<span id="cb49-16"><a></a>  <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, Nt):</span>
<span id="cb49-17"><a></a>    Unp1[:] <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>Un <span class="op">-</span> Unm1 <span class="op">+</span> (c<span class="op">*</span>dt)<span class="op">**</span><span class="dv">2</span><span class="op">*</span>(D <span class="op">@</span> Un <span class="op">+</span> Un <span class="op">@</span> D.T)</span>
<span id="cb49-18"><a></a>    <span class="co"># Set boundary conditions</span></span>
<span id="cb49-19"><a></a>    <span class="co"># Swap solutions</span></span>
<span id="cb49-20"><a></a>    <span class="co"># Store plotdata</span></span>
<span id="cb49-21"><a></a>  <span class="cf">return</span> xij, yij, plotdata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="test-solver" class="slide level2">
<h2>Test solver</h2>
<div class="sourceCode" id="cb50" data-code-line-numbers="1-2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a></a>CFL <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb50-2"><a></a>xij, yij, data <span class="op">=</span> solver(<span class="dv">40</span>, <span class="dv">1</span>, <span class="dv">501</span>, cfl<span class="op">=</span>CFL, store_data<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb50-3"><a></a></span>
<span id="cb50-4"><a></a>fig, ax <span class="op">=</span> plt.subplots(subplot_kw<span class="op">=</span>{<span class="st">"projection"</span>: <span class="st">"3d"</span>})</span>
<span id="cb50-5"><a></a>frames <span class="op">=</span> []</span>
<span id="cb50-6"><a></a><span class="cf">for</span> n, val <span class="kw">in</span> data.items():</span>
<span id="cb50-7"><a></a>  frame <span class="op">=</span> ax.plot_wireframe(xij, yij, val, rstride<span class="op">=</span><span class="dv">2</span>, cstride<span class="op">=</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb50-8"><a></a>  frames.append([frame])</span>
<span id="cb50-9"><a></a></span>
<span id="cb50-10"><a></a>ani <span class="op">=</span> animation.ArtistAnimation(fig, frames, interval<span class="op">=</span><span class="dv">400</span>, blit<span class="op">=</span><span class="va">True</span>,  repeat_delay<span class="op">=</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<img data-src="./figures/wavemovie2d.apng" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="test-solver-with-slightly-higher-than-allowed-cfl" class="slide level2">
<h2>Test solver with slightly higher than allowed CFL</h2>
<div class="sourceCode" id="cb51" data-code-line-numbers="1-2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a></a>CFL <span class="op">=</span> <span class="fl">0.71</span></span>
<span id="cb51-2"><a></a>xij, yij, data <span class="op">=</span> solver(<span class="dv">40</span>, <span class="dv">1</span>, <span class="dv">171</span>, cfl<span class="op">=</span>CFL, store_data<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb51-3"><a></a></span>
<span id="cb51-4"><a></a>fig, ax <span class="op">=</span> plt.subplots(subplot_kw<span class="op">=</span>{<span class="st">"projection"</span>: <span class="st">"3d"</span>})</span>
<span id="cb51-5"><a></a>frames <span class="op">=</span> []</span>
<span id="cb51-6"><a></a><span class="cf">for</span> n, val <span class="kw">in</span> data.items():</span>
<span id="cb51-7"><a></a>  frame <span class="op">=</span> ax.plot_wireframe(xij, yij, val, rstride<span class="op">=</span><span class="dv">2</span>, cstride<span class="op">=</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb51-8"><a></a>  frames.append([frame])</span>
<span id="cb51-9"><a></a></span>
<span id="cb51-10"><a></a>ani <span class="op">=</span> animation.ArtistAnimation(fig, frames, interval<span class="op">=</span><span class="dv">400</span>, blit<span class="op">=</span><span class="va">True</span>,  repeat_delay<span class="op">=</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>



<img data-src="./figures/wavemovie2dunstable.apng" class="quarto-figure quarto-figure-center r-stretch"></section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>